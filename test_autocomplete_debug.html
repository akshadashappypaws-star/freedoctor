<!DOCTYPE html>
<html>
<head>
    <title>Google Places Autocomplete Debug</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        .test-section { margin: 20px 0; padding: 15px; border: 1px solid #ddd; border-radius: 5px; }
        .success { background-color: #d4edda; border-color: #c3e6cb; }
        .error { background-color: #f8d7da; border-color: #f5c6cb; }
        .warning { background-color: #fff3cd; border-color: #ffeaa7; }
        
        #locationInput {
            width: 400px;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-size: 16px;
        }
        
        /* Critical autocomplete styles */
        .pac-container {
            z-index: 10000 !important;
            position: absolute !important;
            display: block !important;
            background: white !important;
            border: 1px solid #ccc !important;
            border-radius: 4px !important;
            box-shadow: 0 2px 6px rgba(0,0,0,0.3) !important;
            margin-top: 2px !important;
        }
        
        .pac-item {
            padding: 10px !important;
            border-bottom: 1px solid #eee !important;
            cursor: pointer !important;
        }
        
        .pac-item:hover {
            background-color: #f0f0f0 !important;
        }
        
        .pac-matched {
            font-weight: bold !important;
        }
    </style>
</head>
<body>
    <h1>Google Places Autocomplete Debug Test</h1>
    
    <div class="test-section">
        <h3>API Status</h3>
        <div id="apiStatus">Loading...</div>
    </div>
    
    <div class="test-section">
        <h3>Location Autocomplete</h3>
        <p>Start typing a location (e.g., "Mumbai", "Delhi", "Pune"):</p>
        <input type="text" id="locationInput" placeholder="Enter location..." autocomplete="off">
        <div id="selectedPlace"></div>
    </div>
    
    <div class="test-section">
        <h3>Debug Log</h3>
        <div id="debug" style="max-height: 300px; overflow-y: auto; background: #f5f5f5; padding: 10px; font-family: monospace; font-size: 12px;"></div>
    </div>

    <script>
        let googleMapsLoaded = false;
        
        function debugLog(message) {
            const timestamp = new Date().toLocaleTimeString();
            console.log(`[${timestamp}] ${message}`);
            document.getElementById('debug').innerHTML += `<div>[${timestamp}] ${message}</div>`;
            document.getElementById('debug').scrollTop = document.getElementById('debug').scrollHeight;
        }
        
        function updateStatus(message, type = 'info') {
            const statusDiv = document.getElementById('apiStatus');
            statusDiv.innerHTML = message;
            statusDiv.className = `test-section ${type}`;
        }

        // Global Google Maps callback functions
        window.handleGoogleMapsLoad = function() {
            debugLog('‚úÖ Google Maps loaded successfully');
            googleMapsLoaded = true;
            updateStatus('Google Maps API loaded successfully!', 'success');
            
            // Initialize Places Autocomplete
            setTimeout(initializePlacesAutocomplete, 100);
        }

        window.handleGoogleMapsError = function() {
            debugLog('‚ùå Google Maps failed to load');
            googleMapsLoaded = false;
            updateStatus('Google Maps API failed to load!', 'error');
        }

        // Load Google Maps script
        function loadGoogleMaps() {
            debugLog('Loading Google Maps API...');
            const script = document.createElement('script');
            script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyBUMcqRhjHNWfj1fh5todf9GV1J9S2QDyc&libraries=places&callback=handleGoogleMapsLoad&loading=async`;
            script.async = true;
            script.defer = true;
            script.onerror = window.handleGoogleMapsError;
            document.head.appendChild(script);
        }

        function initializePlacesAutocomplete() {
            debugLog('üîÑ Initializing Places Autocomplete...');
            
            const locationInput = document.getElementById('locationInput');
            if (!locationInput) {
                debugLog('‚ùå Location input not found');
                return;
            }
            
            if (!window.google || !window.google.maps || !window.google.maps.places) {
                debugLog('‚ùå Google Maps Places API not ready, retrying in 500ms');
                setTimeout(initializePlacesAutocomplete, 500);
                return;
            }
            
            try {
                debugLog('‚úÖ Creating Autocomplete instance...');
                
                const autocomplete = new google.maps.places.Autocomplete(locationInput, {
                    types: ['geocode', 'establishment'],
                    componentRestrictions: { country: 'IN' },
                    fields: ['geometry', 'formatted_address', 'name', 'address_components']
                });
                
                debugLog('‚úÖ Autocomplete instance created');
                
                // Force focus to test
                locationInput.focus();
                
                // Monitor for dropdown creation
                const checkForDropdown = () => {
                    const pacContainer = document.querySelector('.pac-container');
                    if (pacContainer) {
                        debugLog('‚úÖ Dropdown container found');
                        pacContainer.style.zIndex = '10000 !important';
                        pacContainer.style.display = 'block !important';
                        pacContainer.style.position = 'absolute !important';
                        return true;
                    } else {
                        debugLog('‚ö†Ô∏è Dropdown container not found');
                        return false;
                    }
                };
                
                // Check for dropdown periodically
                const intervalId = setInterval(() => {
                    if (checkForDropdown()) {
                        clearInterval(intervalId);
                    }
                }, 100);
                
                setTimeout(() => clearInterval(intervalId), 5000);
                
                // Monitor DOM changes for pac-container
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        mutation.addedNodes.forEach((node) => {
                            if (node.nodeType === 1 && (node.classList?.contains('pac-container') || node.querySelector?.('.pac-container'))) {
                                debugLog('‚úÖ Dropdown detected via mutation observer');
                                checkForDropdown();
                            }
                        });
                    });
                });
                
                observer.observe(document.body, { childList: true, subtree: true });
                
                // Event listeners
                locationInput.addEventListener('focus', () => {
                    debugLog('üîç Input focused');
                    setTimeout(checkForDropdown, 50);
                });
                
                locationInput.addEventListener('input', (e) => {
                    debugLog(`üîç Input changed: "${e.target.value}"`);
                    setTimeout(checkForDropdown, 50);
                });
                
                autocomplete.addListener('place_changed', function() {
                    const place = autocomplete.getPlace();
                    debugLog('üìç Place selected: ' + JSON.stringify({
                        name: place.name,
                        formatted_address: place.formatted_address,
                        hasGeometry: !!place.geometry
                    }));
                    
                    if (place.geometry && place.formatted_address) {
                        document.getElementById('selectedPlace').innerHTML = `
                            <div style="background: #d4edda; padding: 10px; border-radius: 4px; margin-top: 10px;">
                                <strong>Selected:</strong> ${place.formatted_address}<br>
                                <strong>Coordinates:</strong> ${place.geometry.location.lat()}, ${place.geometry.location.lng()}
                            </div>
                        `;
                    } else {
                        document.getElementById('selectedPlace').innerHTML = `
                            <div style="background: #f8d7da; padding: 10px; border-radius: 4px; margin-top: 10px;">
                                Invalid selection - no coordinates available
                            </div>
                        `;
                    }
                });
                
                debugLog('‚úÖ Autocomplete fully initialized');
                updateStatus('Autocomplete ready! Try typing a location...', 'success');
                
            } catch (error) {
                debugLog('‚ùå Error creating autocomplete: ' + error.message);
                updateStatus('Error initializing autocomplete: ' + error.message, 'error');
            }
        }

        // Initialize when DOM is ready
        document.addEventListener('DOMContentLoaded', function() {
            debugLog('üöÄ DOM loaded, starting initialization...');
            loadGoogleMaps();
        });
    </script>
</body>
</html>
