@extends('../user.master')

@section('title', 'Medical Campaigns - FreeDoctor')

@push('head')
<!-- Performance Optimization Meta Tags -->
<meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://maps.googleapis.com">
<link rel="dns-prefetch" href="//maps.googleapis.com">
<link rel="dns-prefetch" href="//fonts.gstatic.com">

<!-- Preload critical resources -->
<link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
<link rel="preload" as="image" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E">
@endpush

@push('styles')
<!-- External Campaign Styles -->
<link rel="stylesheet" href="{{ asset('css/campaigns.css') }}">
@endpush

@section('content')
/* ===== CAMPAIGNS PAGE STYLES ===== */
:root {
    --primary-color: #2C2A4C;
    --secondary-color: #E7A51B;
    --background-color: #f5f5f5;
    --surface-color: #ffffff;
    --text-primary: #212121;
    --text-secondary: #757575;
    --shadow-color: rgba(0, 0, 0, 0.12);
    --accent-color: #F7C873;
    --success-color: #4CAF50;
    --danger-color: #E53935;
    --border-radius: 16px;
    --warning-color: #FF9800;
    --info-color: #2196F3;
    --white: #ffffff;
    --light-gray: #f8f9fa;
    --border-color: #e9ecef;
    --text-dark: #2d3748;
    --text-muted: #6c757d;
    --shadow-sm: 0 2px 4px rgba(0,0,0,0.1);
    --shadow-md: 0 4px 8px rgba(0,0,0,0.15);
    --shadow-lg: 0 8px 16px rgba(0,0,0,0.2);
    --radius-sm: 8px;
    --radius-md: 12px;
    --radius-lg: 16px;
}

/* Performance Optimizations */

/* Optimize animations */
.campaign-card {
    will-change: transform;
    transform: translateZ(0);
    contain: layout style paint;
}

/* Lazy loading placeholder */
.lazy-load {
    transition: opacity 0.3s ease;
    opacity: 0;
    content-visibility: auto;
}

.lazy-load.loaded {
    opacity: 1;
}

/* Performance optimizations for heavy elements */
.campaign-image-responsive,
.video-container-full,
.campaign-placeholder {
    contain: layout style paint;
    transform: translateZ(0);
}

/* Optimize progress bars */
.progress-fill {
    will-change: width;
    transform: translateZ(0);
}

/* Optimize hover effects */

.campaign-card:hover {
    transform: translateZ(0) translateY(-2px);
}

/* Page Header */
.campaigns-header {
    background: linear-gradient(135deg, var(--primary-color) 0%, #4a47a3 100%);
    color: var(--white);
    padding: 4rem 0 3rem;
    position: relative;
    overflow: hidden;
}

.campaigns-header::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
    animation: float 20s infinite linear;
}

@keyframes float {
    0% { transform: translateY(0); }
    100% { transform: translateY(-100px); }
}

.campaigns-header h1 {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 1rem;
    text-shadow: 0 2px 4px rgba(0,0,0,0.3);
}

.campaigns-header p {
    font-size: 1.25rem;
    opacity: 0.9;
    margin-bottom: 0;
}

/* Search Section */
.search-section {
    background: linear-gradient(135deg, var(--primary-color) 0%, #3a3564 100%);
    padding: 2rem 1rem;
    position: relative;
    overflow: hidden;
}

.search-section::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: url('data:image/svg+xml,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 100 100"><circle cx="50" cy="50" r="2" fill="rgba(255,255,255,0.1)"/></svg>') repeat;
    opacity: 0.3;
}

.search-card {
    background: var(--surface-color);
    border-radius: var(--border-radius);
    padding: 1.5rem;
    box-shadow: 0 8px 32px var(--shadow-color);
    backdrop-filter: blur(10px);
    position: relative;
    z-index: 2;
    margin: 0 auto;
    max-width: 1200px;
}

.search-compact {
    display: flex;
    gap: 0.5rem;
    align-items: center;
    width: 100%;
    flex-wrap: nowrap;
}

.search-input-compact {
    flex: 1;
    position: relative;
    min-width: 0;
}

.search-input-compact input {
    width: 100%;
    padding: 0.875rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 12px;
    font-size: 1rem;
    background: var(--surface-color);
    color: var(--text-primary);
    transition: all 0.3s ease;
    outline: none;
}

.search-input-compact input:focus {
    border-color: var(--secondary-color);
    box-shadow: 0 0 0 3px rgba(231, 165, 27, 0.1);
}

.search-input-compact input::placeholder {
    color: var(--text-secondary);
}

.location-btn-compact,
.reset-btn-compact {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 0.875rem 1rem;
    border-radius: 12px;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    font-weight: 500;
    white-space: nowrap;
    position: relative;
    min-width: 44px;
    justify-content: center;
    flex-shrink: 0;
}

.location-btn-compact:hover {
    background: var(--secondary-color);
    color: var(--primary-color);
    transform: translateY(-1px);
}

.reset-btn-compact {
    background: var(--danger-color);
}

.reset-btn-compact:hover {
    background: #c62828;
    transform: translateY(-1px);
}

.btn-text {
    font-size: 0.9rem;
    font-weight: 500;
}

.filter-count {
    background: var(--danger-color);
    color: white;
    border-radius: 50%;
    width: 20px;
    height: 20px;
    font-size: 0.75rem;
    display: flex;
    align-items: center;
    justify-content: center;
    position: absolute;
    top: -5px;
    right: -5px;
    font-weight: 600;
}

/* Active Filters */
.active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
    padding-top: 1rem;
    border-top: 1px solid #e0e0e0;
}

.filter-badge-compact {
    background: var(--primary-color);
    color: white;
    padding: 0.5rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.25rem;
}

.clear-all-filters {
    background: var(--danger-color);
    color: white;
    border: none;
    padding: 0.5rem 0.75rem;
    border-radius: 20px;
    font-size: 0.875rem;
    cursor: pointer;
    display: flex;
    align-items: center;
    gap: 0.25rem;
    transition: all 0.3s ease;
}

.clear-all-filters:hover {
    background: #c62828;
    transform: translateY(-1px);
}

/* Search Suggestions */
.search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--surface-color);
    border: 1px solid #e0e0e0;
    border-radius: 8px;
    box-shadow: 0 4px 12px var(--shadow-color);
    z-index: 1000;
    max-height: 300px;
    overflow-y: auto;
    display: none;
}

.suggestion-item {
    padding: 0.75rem 1rem;
    cursor: pointer;
    border-bottom: 1px solid #f0f0f0;
    transition: background 0.2s ease;
}

.suggestion-item:hover {
    background: var(--background-color);
}

.suggestion-item:last-child {
    border-bottom: none;
}

/* Modal Styles */
.location-modal,
.filter-modal {
    position: fixed;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background: rgba(0, 0, 0, 0.5);
    display: none;
    align-items: center;
    justify-content: center;
    z-index: 10000;
    backdrop-filter: blur(5px);
}

.modal-content-compact {
    background: var(--surface-color);
    border-radius: var(--border-radius);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);
    animation: modalSlideIn 0.3s ease;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-20px) scale(0.95);
    }
    to {
        opacity: 1;
        transform: translateY(0) scale(1);
    }
}

.modal-header-compact {
    padding: 1.5rem 1.5rem 1rem;
    border-bottom: 1px solid #e0e0e0;
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.modal-header-compact h3 {
    color: var(--primary-color);
    margin: 0;
    font-size: 1.25rem;
    font-weight: 700;
}

.modal-close {
    background: none;
    border: none;
    color: var(--text-secondary);
    cursor: pointer;
    padding: 0.5rem;
    border-radius: 50%;
    transition: all 0.3s ease;
}

.modal-close:hover {
    background: var(--background-color);
    color: var(--text-primary);
}

.modal-body-compact {
    padding: 1.5rem;
}

.modal-footer-compact {
    padding: 1rem 1.5rem 1.5rem;
    border-top: 1px solid #e0e0e0;
    display: flex;
    gap: 0.5rem;
    justify-content: flex-end;
}

/* Filter Modal Specific */
.filter-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 1rem;
}

.filter-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.filter-item label {
    color: var(--text-primary);
    font-weight: 600;
    font-size: 0.9rem;
}

.filter-item select,
.filter-item input {
    padding: 0.75rem 1rem;
    border: 2px solid #e0e0e0;
    border-radius: 8px;
    font-size: 1rem;
    outline: none;
    transition: border-color 0.3s ease;
}

.filter-item select:focus,
.filter-item input:focus {
    border-color: var(--secondary-color);
}

/* Button Styles */
.btn {
    padding: 0.75rem 1.5rem;
    border-radius: 8px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    border: none;
    font-size: 0.9rem;
}

.btn-primary {
    background: var(--primary-color);
    color: white;
}

.btn-primary:hover {
    background: #3a3564;
    transform: translateY(-1px);
}

.btn-secondary {
    background: var(--text-secondary);
    color: white;
}

.btn-secondary:hover {
    background: #616161;
}

.btn-outline-danger {
    background: transparent;
    color: var(--danger-color);
    border: 2px solid var(--danger-color);
}

.btn-outline-danger:hover {
    background: var(--danger-color);
    color: white;
}

/* Mobile Optimizations */
@media (max-width: 768px) {
    .search-section {
        padding: 1.5rem 0.5rem;
    }

    .search-card {
        padding: 1rem;
        margin: 0 0.5rem;
    }

    .search-compact {
        gap: 0.5rem;
        flex-wrap: nowrap;
    }

    .search-input-compact {
        flex: 1;
        min-width: 0;
    }

    .search-input-compact input {
        font-size: 16px; /* Prevents zoom on iOS */
        padding: 0.75rem 0.875rem;
    }

    .location-btn-compact,
    .reset-btn-compact {
        padding: 0.75rem 0.875rem;
        flex-shrink: 0;
        min-width: 44px;
    }

    .btn-text {
        font-size: 0.85rem;
    }

    .location-btn-compact .btn-text,
    .location-btn-compact .btn-text,
    .reset-btn-compact .btn-text {
        display: block;
    }

    .reset-btn-compact .btn-text {
        display: none;
    }

    .modal-content-compact {
        width: 95%;
        margin: 1rem;
    }

    .modal-header-compact,
    .modal-body-compact,
    .modal-footer-compact {
        padding: 1rem;
    }

    .filter-grid {
        grid-template-columns: 1fr;
    }

    .modal-footer-compact {
        flex-direction: column;
    }

    .modal-footer-compact .btn {
        width: 100%;
    }
}

@media (max-width: 480px) {
    .search-card {
        padding: 0.75rem;
        margin: 0 0.25rem;
    }

    .search-input-compact input {
        padding: 0.625rem 0.75rem;
        font-size: 16px;
    }

    .location-btn-compact,
    .reset-btn-compact {
        padding: 0.625rem 0.5rem;
        min-width: 40px;
    }

    .btn-text {
        font-size: 0.8rem;
    }
}

@media (min-width: 769px) {
    .search-compact {
        max-width: 1000px;
        margin: 0 auto;
    }

    .filter-grid {
        grid-template-columns: repeat(2, 1fr);
    }

    .btn-text {
        display: block;
    }
}

@media (min-width: 1024px) {
    .search-section {
        padding: 1rem 2rem;
    }

    .search-card {
        padding: 1.5rem;
    }

    .search-input-compact input {
        padding: 0.875rem 1rem;
        font-size: 1rem;
    }

    .location-btn-compact,
    .reset-btn-compact {
        padding: 0.875rem 1rem;
    }
    
    /* Further optimize for large screens */
    .campaign-image-full {
        height: 150px;
    }
    
    .campaign-content-full {
        padding: 10px;
    }
    
    .progress-section-full {
        padding: 8px;
    }
    
    .campaign-container .row {
        row-gap: 10px;
    }
}

.compact-btn {
    background: var(--primary-color);
    color: var(--white);
    border: none;
    padding: 0.875rem 1.25rem;
    border-radius: var(--radius-md);
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    white-space: nowrap;
}

.compact-btn:hover {
    background: #4a47a3;
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.location-btn-compact {
    background: var(--secondary-color);
    color: var(--white);
    border: none;
    padding: 0.875rem;
    border-radius: var(--radius-md);
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
}

.location-btn-compact:hover {
    background: #d4751a;
    transform: translateY(-2px);
}

.filter-btn-compact {
    background: var(--info-color);
    color: var(--white);
    border: none;
    padding: 0.875rem 1.25rem;
    border-radius: var(--radius-md);
    font-weight: 600;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.filter-btn-compact:hover {
    background: #1976D2;
    transform: translateY(-2px);
}

/* Modal Styles */
.search-modal, .filter-modal, .location-modal {
    display: none;
    position: fixed;
    z-index: 2000;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    background-color: rgba(0,0,0,0.5);
    backdrop-filter: blur(5px);
}

.modal-content-compact {
    background: var(--white);
    margin: auto;
    padding: 0;
    border-radius: var(--radius-lg);
    width: 90%;
    max-width: 500px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    top: 50%;
    transform: translateY(-50%);
    animation: modalSlideIn 0.3s ease-out;
}

@keyframes modalSlideIn {
    from {
        opacity: 0;
        transform: translateY(-50%) scale(0.9);
    }
    to {
        opacity: 1;
        transform: translateY(-50%) scale(1);
    }
}

.modal-header-compact {
    padding: 1.5rem;
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: between;
    align-items: center;
    background: var(--primary-color);
    color: var(--white);
    border-radius: var(--radius-lg) var(--radius-lg) 0 0;
}

.modal-header-compact h3 {
    margin: 0;
    font-size: 1.25rem;
    font-weight: 600;
}

.modal-close {
    background: none;
    border: none;
    color: var(--white);
    font-size: 1.5rem;
    cursor: pointer;
    padding: 0;
    width: 32px;
    height: 32px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    transition: background 0.3s ease;
}

.modal-close:hover {
    background: rgba(255,255,255,0.2);
}

.modal-body-compact {
    padding: 1.5rem;
}

.modal-footer-compact {
    padding: 1rem 1.5rem;
    border-top: 1px solid var(--border-color);
    display: flex;
    gap: 1rem;
    justify-content: flex-end;
}

/* Filter Grid in Modal */
.filter-grid {
    display: grid;
    gap: 1rem;
    margin-bottom: 1.5rem;
}

.filter-item {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.filter-item label {
    font-weight: 600;
    color: var(--text-dark);
    font-size: 0.9rem;
}

.filter-item select, .filter-item input {
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    background: var(--white);
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.filter-item select:focus, .filter-item input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(44, 42, 76, 0.1);
}

/* Location Search */
.location-search-container {
    position: relative;
    margin-bottom: 1rem;
}

.search-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
}

.search-icon {
    position: absolute;
    left: 1rem;
    color: var(--text-muted);
    z-index: 2;
}

.location-search-input {
    width: 100%;
    padding: 1rem 1rem 1rem 2.5rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 1rem;
    transition: all 0.3s ease;
    background: var(--white);
}

.location-search-input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(44, 42, 76, 0.1);
}

.search-loading {
    position: absolute;
    right: 1rem;
    color: var(--primary-color);
    z-index: 2;
}

.location-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--white);
    border: 1px solid var(--border-color);
    border-top: none;
    border-radius: 0 0 var(--radius-md) var(--radius-md);
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    max-height: 200px;
    overflow-y: auto;
    display: none;
}

.location-suggestion-item {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: background 0.3s ease;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.location-suggestion-item:hover {
    background: var(--light-gray);
}

.location-suggestion-item:last-child {
    border-bottom: none;
}

.location-suggestion-item i {
    color: var(--primary-color);
    font-size: 1rem;
    width: 16px;
}

.location-suggestion-text {
    flex: 1;
}

.location-suggestion-main {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
}

.location-suggestion-sub {
    font-size: 0.875rem;
    color: var(--text-muted);
}

/* Current Location Section */
.current-location-section {
    margin-bottom: 1.5rem;
    text-align: center;
}

.current-location-btn {
    background: linear-gradient(135deg, var(--primary-color), #4a47a3);
    color: var(--white);
    border: none;
    padding: 1rem 1.5rem;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 600;
    box-shadow: var(--shadow-sm);
    position: relative;
    width: 100%;
    justify-content: center;
}

.current-location-btn:hover {
    background: linear-gradient(135deg, #4a47a3, var(--primary-color));
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
}

.current-location-btn:disabled {
    background: var(--border-color);
    cursor: not-allowed;
    transform: none;
}

.location-status {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    margin-left: auto;
}

.location-accuracy {
    margin-top: 0.5rem;
    text-align: center;
}

/* OR Divider */
.divider-or {
    position: relative;
    text-align: center;
    margin: 1.5rem 0;
}

.divider-or::before {
    content: '';
    position: absolute;
    top: 50%;
    left: 0;
    right: 0;
    height: 1px;
    background: var(--border-color);
    z-index: 1;
}

.divider-or span {
    background: var(--white);
    padding: 0 1rem;
    color: var(--text-muted);
    font-weight: 600;
    position: relative;
    z-index: 2;
}

/* Selected Location Info */
.selected-location-info {
    background: var(--light-gray);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-md);
    padding: 1rem;
    margin-top: 1rem;
}

.location-preview {
    display: flex;
    align-items: center;
    gap: 1rem;
}

.location-preview i {
    color: var(--primary-color);
    font-size: 1.5rem;
}

.location-details {
    flex: 1;
}

.location-details strong {
    display: block;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
}

/* Location Active Indicator */
.location-active-indicator {
    margin-left: 0.5rem;
    color: var(--success-color);
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.5; }
}

/* Search Loading States */
.search-loading {
    color: var(--primary-color);
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

/* Location Badge Color Variations */
.distance-very-near {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
}

.distance-nearby {
    background: linear-gradient(135deg, #17a2b8, #6f42c1);
    color: white;
}

.distance-close {
    background: linear-gradient(135deg, #ffc107, #fd7e14);
    color: white;
}

.distance-moderate {
    background: linear-gradient(135deg, #fd7e14, #dc3545);
    color: white;
}

.distance-far {
    background: linear-gradient(135deg, #dc3545, #6f42c1);
    color: white;
}

.distance-very-far {
    background: linear-gradient(135deg, #6c757d, #495057);
    color: white;
}

.current-location-btn {
    background: var(--secondary-color);
    color: var(--white);
    border: none;
    padding: 1rem;
    border-radius: var(--radius-md);
    font-weight: 600;
    width: 100%;
    margin-top: 1rem;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.current-location-btn:hover {
    background: #d4751a;
}

/* Active Filter Badge */
.active-filters {
    display: flex;
    flex-wrap: wrap;
    gap: 0.5rem;
    margin-top: 1rem;
}

.filter-badge-compact {
    background: var(--primary-color);
    color: var(--white);
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.8rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.clear-all-filters {
    background: var(--danger-color);
    color: var(--white);
    border: none;
    padding: 0.5rem 1rem;
    border-radius: var(--radius-sm);
    font-size: 0.85rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.clear-all-filters:hover {
    background: #c82333;
}

/* Responsive Design */
@media (max-width: 768px) {
    .search-compact {
        flex-direction: column;
        align-items: stretch;
    }
    
    .search-input-compact {
        min-width: auto;
    }
    
    .compact-btn, .location-btn-compact, .filter-btn-compact {
        justify-content: center;
    }
    
    .modal-content-compact {
        width: 95%;
        height: 100vh;
        max-height: 100vh;
        border-radius: 0;
        top: 0;
        transform: none;
        margin: 0;
        position: fixed;
    }
    
    .modal-header-compact {
        border-radius: 0;
    }
    
    .filter-grid {
        grid-template-columns: 1fr;
    }
}

@media (min-width: 769px) {
    .modal-content-compact {
        max-width: 600px;
    }
    
    .filter-grid {
        grid-template-columns: 1fr 1fr;
    }
}

/* Filter Section */
.filters-section {
    background: var(--light-gray);
    padding: 1.5rem 0;
    border-bottom: 1px solid var(--border-color);
}

.filter-row {
    display: flex;
    gap: 1rem;
    align-items: center;
    flex-wrap: wrap;
}

.filter-select {
    min-width: 150px;
    padding: 0.75rem;
    border: 1px solid var(--border-color);
    border-radius: var(--radius-sm);
    background: var(--white);
    font-size: 0.9rem;
    transition: all 0.3s ease;
}

.filter-select:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 2px rgba(44, 42, 76, 0.1);
}

.filter-badge {
    background: var(--primary-color);
    color: var(--white);
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.85rem;
    font-weight: 500;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.clear-filters {
    color: var(--danger-color);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.3s ease;
}

.clear-filters:hover {
    color: #c82333;
    text-decoration: underline;
}

/* Campaign Grid */
.campaigns-grid {
    padding: 3rem 0;
    min-height: 60vh;
}

.campaign-card {
    background: var(--white);
    border-radius: var(--radius-lg);
    overflow: hidden;
    box-shadow: var(--shadow-sm);
    transition: all 0.3s ease;
    height: 100%;
    display: flex;
    flex-direction: column;
    border: 1px solid var(--border-color);
    margin-bottom: 2rem;
}

.campaign-card:hover {
    transform: translateY(-8px);
    box-shadow: var(--shadow-lg);
    border-color: var(--primary-color);
}

.campaign-image {
    position: relative;
    height: 200px;
    overflow: hidden;
    cursor: pointer;
}

.campaign-image img,
.campaign-image .campaign-video,
.campaign-image iframe.campaign-video {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
}

.campaign-video {
    border-radius: 0;
}

.campaign-card:hover .campaign-image img,
.campaign-card:hover .campaign-image .campaign-video {
    transform: scale(1.05);
}

.campaign-status {
    position: absolute;
    top: 1rem;
    right: 1rem;
    padding: 0.5rem 1rem;
    border-radius: 50px;
    font-size: 0.8rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-ongoing { background: var(--success-color); color: var(--white); }
.status-upcoming { background: var(--info-color); color: var(--white); }
.status-completed { background: var(--text-muted); color: var(--white); }

.campaign-type {
    position: absolute;
    top: 1rem;
    left: 1rem;
    background: rgba(0,0,0,0.8);
    color: var(--white);
    padding: 0.25rem 0.75rem;
    border-radius: 50px;
    font-size: 0.75rem;
    text-transform: capitalize;
}

.campaign-content {
    padding: 1.5rem;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.campaign-title {
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--text-dark);
    margin-bottom: 0.75rem;
    line-height: 1.4;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.campaign-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    margin-bottom: 1rem;
    font-size: 0.9rem;
    color: var(--text-muted);
}

.meta-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.meta-item i {
    color: var(--primary-color);
    width: 16px;
}

.campaign-description {
    color: var(--text-muted);
    font-size: 0.95rem;
    line-height: 1.6;
    margin-bottom: 1.5rem;
    flex: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.campaign-price {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 1.5rem;
    padding: 1rem;
    background: var(--light-gray);
    border-radius: var(--radius-sm);
}

.price-label {
    font-size: 0.9rem;
    color: var(--text-muted);
    font-weight: 500;
}

.price-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--primary-color);
}

.price-free {
    color: var(--success-color);
}

.campaign-actions {
    display: flex;
    gap: 0.75rem;
    margin-top: auto;
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary-color) 0%, #4a47a3 100%);
    color: var(--white);
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-sm);
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    transition: all 0.3s ease;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: var(--shadow-md);
    color: var(--white);
    text-decoration: none;
}

.btn-secondary {
    background: var(--white);
    color: var(--primary-color);
    border: 2px solid var(--primary-color);
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-sm);
    font-weight: 600;
    text-decoration: none;
    text-align: center;
    transition: all 0.3s ease;
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.btn-secondary:hover {
    background: var(--primary-color);
    color: var(--white);
    text-decoration: none;
    transform: translateY(-2px);
}

/* Stats Section */
.stats-section {
    background: linear-gradient(135deg, var(--primary-color) 0%, #4a47a3 100%);
    color: var(--white);
    padding: 4rem 0;
}

.stat-card {
    text-align: center;
    padding: 2rem;
    background: rgba(255,255,255,0.1);
    border-radius: var(--radius-lg);
    backdrop-filter: blur(10px);
    transition: transform 0.3s ease;
}

.stat-card:hover {
    transform: translateY(-8px);
}

.stat-icon {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: var(--secondary-color);
}

.stat-number {
    font-size: 2.5rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.stat-label {
    font-size: 1.1rem;
    opacity: 0.9;
}

/* Pagination */
.pagination-wrapper {
    padding: 3rem 0;
    background: var(--light-gray);
    border-top: 1px solid var(--border-color);
}

.pagination {
    justify-content: center;
    margin: 0;
}

.page-link {
    color: var(--primary-color);
    border: 1px solid var(--border-color);
    padding: 0.75rem 1rem;
    font-weight: 500;
    transition: all 0.3s ease;
}

.page-link:hover {
    background: var(--primary-color);
    color: var(--white);
    border-color: var(--primary-color);
}

.page-item.active .page-link {
    background: var(--primary-color);
    border-color: var(--primary-color);
    color: var(--white);
}

/* No Results */
.no-results {
    text-align: center;
    padding: 4rem 2rem;
    color: var(--text-muted);
}

.no-results i {
    font-size: 4rem;
    margin-bottom: 1.5rem;
    color: var(--border-color);
}

.no-results h3 {
    font-size: 1.5rem;
    margin-bottom: 1rem;
    color: var(--text-dark);
}

/* Search Suggestions */
.search-suggestions {
    position: absolute;
    top: 100%;
    left: 0;
    right: 0;
    background: var(--white);
    border: 1px solid var(--border-color);
    border-top: none;
    border-radius: 0 0 var(--radius-md) var(--radius-md);
    box-shadow: var(--shadow-lg);
    z-index: 1000;
    max-height: 400px;
    overflow-y: auto;
    display: none;
}

.search-results-header {
    padding: 1rem;
    background: var(--light-gray);
    border-bottom: 1px solid var(--border-color);
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.search-results-header strong {
    color: var(--text-dark);
    font-size: 0.9rem;
}

.search-type {
    background: var(--primary-color);
    color: var(--white);
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.search-section-header {
    padding: 0.75rem 1rem;
    background: var(--primary-color);
    color: var(--white);
    font-weight: 600;
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
    border-bottom: 1px solid var(--border-color);
}

.search-result-item {
    padding: 1rem;
    border-bottom: 1px solid var(--border-color);
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    gap: 1rem;
}

.search-result-item:hover {
    background: var(--light-gray);
    transform: translateX(4px);
}

.search-result-item:last-child {
    border-bottom: none;
}

.result-icon {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--white);
    font-weight: 600;
    flex-shrink: 0;
}

.result-icon.campaigns {
    background: linear-gradient(135deg, #28a745, #20c997);
}

.result-icon.categories {
    background: linear-gradient(135deg, #007bff, #0056b3);
}

.result-icon.doctors {
    background: linear-gradient(135deg, #6f42c1, #5a2d91);
}

.result-icon.specialties {
    background: linear-gradient(135deg, #fd7e14, #e55f00);
}

.result-content {
    flex: 1;
    min-width: 0;
}

.result-title {
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.25rem;
    font-size: 0.95rem;
}

.result-meta {
    display: flex;
    flex-wrap: wrap;
    gap: 1rem;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.result-meta span {
    display: flex;
    align-items: center;
    gap: 0.375rem;
}

.result-meta i {
    width: 12px;
    color: var(--primary-color);
}

.result-price {
    text-align: right;
    font-weight: 600;
    color: var(--primary-color);
}

.free-badge {
    background: var(--success-color);
    color: var(--white);
    padding: 0.25rem 0.5rem;
    border-radius: 12px;
    font-size: 0.75rem;
    font-weight: 600;
}

.distance-info {
    color: var(--success-color) !important;
    font-weight: 600 !important;
}

.no-search-results {
    padding: 3rem 2rem;
    text-align: center;
    color: var(--text-muted);
}

.no-search-results i {
    font-size: 3rem;
    margin-bottom: 1rem;
    color: var(--border-color);
}

.no-search-results p {
    font-size: 1.1rem;
    font-weight: 600;
    color: var(--text-dark);
    margin-bottom: 0.5rem;
}

.search-loading-item {
    padding: 1.5rem;
    text-align: center;
    color: var(--text-muted);
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
}

.search-error {
    padding: 1rem;
    text-align: center;
    color: var(--danger-color);
    background: rgba(229, 57, 53, 0.1);
    border: 1px solid rgba(229, 57, 53, 0.2);
    border-radius: var(--radius-sm);
    margin: 0.5rem;
}

.search-error-sub {
    font-size: 0.8rem;
    opacity: 0.8;
    margin-top: 0.5rem;
}

.search-notice {
    padding: 1rem;
    text-align: center;
    color: var(--primary-color);
    background: rgba(44, 42, 76, 0.1);
    border: 1px solid rgba(44, 42, 76, 0.2);
    border-radius: var(--radius-sm);
    margin: 0.5rem;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.search-view-all {
    padding: 1rem;
    border-top: 1px solid var(--border-color);
    background: var(--light-gray);
}

.view-all-btn {
    width: 100%;
    background: var(--primary-color);
    color: var(--white);
    border: none;
    padding: 0.75rem 1rem;
    border-radius: var(--radius-sm);
    font-weight: 600;
    cursor: pointer;
    transition: all 0.3s ease;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
}

.view-all-btn:hover {
    background: #4a47a3;
    transform: translateY(-1px);
}

/* Responsive Design for Search */
@media (max-width: 768px) {
    .search-suggestions {
        max-height: 300px;
    }
    
    .result-meta {
        flex-direction: column;
        gap: 0.25rem;
    }
    
    .result-meta span {
        font-size: 0.75rem;
    }
    
    .search-result-item {
        padding: 0.75rem;
        gap: 0.75rem;
    }
    
    .result-icon {
        width: 32px;
        height: 32px;
        font-size: 0.875rem;
    }
    
    .result-title {
        font-size: 0.875rem;
    }
}

/* Responsive Design */
@media (max-width: 768px) {
    .campaigns-header h1 {
        font-size: 2rem;
    }
    
    .campaigns-header p {
        font-size: 1rem;
    }
    
    .search-card {
        margin-top: -2rem;
        padding: 1.5rem;
    }
    
    .filter-row {
        flex-direction: column;
        align-items: stretch;
    }
    
    .filter-select {
        width: 100%;
        margin-bottom: 0.5rem;
    }
    
    .campaign-actions {
        flex-direction: column;
    }
    
    .stat-card {
        margin-bottom: 2rem;
    }
}

@media (max-width: 576px) {
    .campaigns-header {
        padding: 3rem 0 2rem;
    }
    
    .search-input input {
        padding: 0.875rem 0.875rem 0.875rem 2.5rem;
        font-size: 0.9rem;
    }
    
    .campaign-card {
        margin-bottom: 1.5rem;
    }
    
    .btn-primary, .btn-secondary {
        padding: 0.625rem 1rem;
        font-size: 0.9rem;
    }
}

/* Animation Classes */
.fade-in {
    animation: fadeIn 0.6s ease-out;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

.slide-up {
    animation: slideUp 0.8s ease-out;
}

@keyframes slideUp {
    from { opacity: 0; transform: translateY(40px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Compact Layout Styles - Full Width Design */
.compact-layout {
    display: flex;
    flex-direction: column;
    height: 100%;
    border-radius: 16px;
    overflow: hidden;
    background: #fff;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.12);
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    border: 1px solid rgba(255, 255, 255, 0.18);
}

.compact-layout:hover {
    transform: translateY(-8px);
    box-shadow: 0 16px 48px rgba(0, 0, 0, 0.2);
    border-color: #667eea;
}

/* Full Width Image Section */
.campaign-image-full {
    width: 100%;
    height: 180px;
    position: relative;
    overflow: hidden;
    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
    cursor: pointer;
}

.campaign-image-responsive {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease;
}

.campaign-image-full:hover .campaign-image-responsive {
    transform: scale(1.05);
}

.campaign-placeholder {
    height: 100%;
    background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
    color: white;
}

.video-container-full {
    width: 100%;
    height: 100%;
    position: relative;
}

.video-container-full iframe,
.video-container-full video {
    width: 100%;
    height: 100%;
    border: none;
}

.video-overlay {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    color: white;
    font-size: 4rem;
    opacity: 0.9;
    pointer-events: none;
    text-shadow: 0 4px 8px rgba(0, 0, 0, 0.3);
}

/* Full Width Content Section */
.campaign-content-full {
    padding: 15px;
    flex: 1;
    display: flex;
    flex-direction: column;
}

.campaign-title-full {
    font-size: 1.3rem;
    font-weight: 700;
    color: #2C2A4C;
    line-height: 1.3;
    margin-bottom: 12px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

/* Enhanced Detail Grid */
.campaign-detail-grid {
    margin-bottom: 12px;
}

.detail-row {
    display: flex;
    gap: 15px;
    margin-bottom: 6px;
}

.detail-item-full {
    display: flex;
    align-items: center;
    gap: 8px;
    font-size: 0.85rem;
    color: #4a5568;
    font-weight: 500;
    flex: 1;
}

.detail-item-full.location-full {
    flex: 2;
}

.detail-item-full i {
    width: 16px;
    text-align: center;
    font-size: 1rem;
}

/* Compact Detail Items */
.compact-detail {
    font-size: 0.75rem !important;
}

.compact-detail i {
    font-size: 0.85rem !important;
    width: 14px;
}

.compact-detail span {
    font-size: 0.75rem !important;
    font-weight: 500;
}

/* Location Button with Dual Icons */
.location-btn-compact i {
    margin-right: 3px;
}

.location-btn-compact i:last-of-type {
    margin-right: 6px;
}

/* Description */
.campaign-description-full {
    font-size: 0.9rem;
    color: #6c757d;
    line-height: 1.5;
    margin-bottom: 15px;
    background: #f8f9fa;
    padding: 10px;
    border-radius: 8px;
    border-left: 4px solid #667eea;
}

/* Action Buttons Row */
.campaign-actions-row {
    display: flex;
    gap: 8px;
    margin-bottom: 15px;
}

.btn-action {
    flex: 1;
    padding: 10px 14px;
    border: none;
    border-radius: 10px;
    font-size: 0.85rem;
    font-weight: 600;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
    text-decoration: none;
    cursor: pointer;
}





.btn-register-full {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
    box-shadow: 0 4px 15px rgba(40, 167, 69, 0.3);
}

.btn-register-full:hover {
    background: linear-gradient(135deg, #20c997, #28a745);
    box-shadow: 0 8px 25px rgba(40, 167, 69, 0.4);
}

.btn-sponsor-full {
    background: linear-gradient(135deg, #fd7e14, #ffc107);
    color: white;
    box-shadow: 0 4px 15px rgba(253, 126, 20, 0.3);
}

.btn-sponsor-full:hover {
    background: linear-gradient(135deg, #ffc107, #fd7e14);
    box-shadow: 0 8px 25px rgba(253, 126, 20, 0.4);
}

.btn-share-full {
    background: linear-gradient(135deg, #6f42c1, #e83e8c);
    color: white;
    box-shadow: 0 4px 15px rgba(111, 66, 193, 0.3);
}

.btn-share-full:hover {
    background: linear-gradient(135deg, #e83e8c, #6f42c1);
    box-shadow: 0 8px 25px rgba(111, 66, 193, 0.4);
}

.btn-action:disabled {
    background: #6c757d;
    opacity: 0.6;
    cursor: not-allowed;
}

/* Progress Section */
.progress-section-full {
    background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
    padding: 12px;
    border-radius: 12px;
    border: 1px solid #e9ecef;
}

.progress-item-full {
    margin-bottom: 8px;
}

.progress-item-full:last-child {
    margin-bottom: 0;
}

.progress-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
}

.progress-label {
    font-size: 0.8rem;
    font-weight: 600;
    color: #2C2A4C;
}

.progress-value {
    font-size: 0.8rem;
    font-weight: 700;
    color: #667eea;
}

.progress-bar-full {
    height: 6px;
    background: #e9ecef;
    border-radius: 3px;
    overflow: hidden;
    margin-bottom: 4px;
}

.progress-fill {
    height: 100%;
    border-radius: 4px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
}

.progress-fill::after {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: linear-gradient(45deg, transparent 30%, rgba(255, 255, 255, 0.3) 50%, transparent 70%);
    animation: progressShine 2s infinite;
}

@keyframes progressShine {
    0% { transform: translateX(-100%); }
    100% { transform: translateX(100%); }
}

.registration-progress {
    background: linear-gradient(90deg, #28a745, #20c997);
}

.sponsorship-progress {
    background: linear-gradient(90deg, #fd7e14, #ffc107);
}

.progress-percentage {
    font-size: 0.75rem;
    color: #6c757d;
    font-weight: 500;
    text-align: right;
}

/* Enhanced Badges */
.full-width-badge {
    position: absolute;
    top: 12px;
    left: 12px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    z-index: 2;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    width: auto;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

.full-width-cost-badge {
    position: absolute;
    top: 12px;
    right: 12px;
    padding: 6px 12px;
    border-radius: 20px;
    font-size: 0.75rem;
    font-weight: 600;
    z-index: 2;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
    width: auto;
    display: inline-flex;
    align-items: center;
    gap: 0.25rem;
}

/* Distance Badge Color Variations */
.distance-very-near {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
}

.distance-nearby {
    background: linear-gradient(135deg, #17a2b8, #6f42c1);
    color: white;
}

.distance-close {
    background: linear-gradient(135deg, #ffc107, #fd7e14);
    color: white;
}

.distance-moderate {
    background: linear-gradient(135deg, #fd7e14, #dc3545);
    color: white;
}

.distance-far {
    background: linear-gradient(135deg, #dc3545, #6f42c1);
    color: white;
}

.distance-very-far {
    background: linear-gradient(135deg, #6c757d, #495057);
    color: white;
}

.cost-free {
    background: linear-gradient(135deg, #28a745, #20c997);
    color: white;
}

.cost-paid {
    background: linear-gradient(135deg, #2C2A4C, #667eea);
    color: white;
}

/* Space Optimization */
.campaign-container .row {
    margin-bottom: 0;
    row-gap: 15px;
}

.campaign-container {
    padding-top: 2rem;
 
}

/* Reduce section padding */
.section-padding {
    padding: 3rem 0 2rem;
}

.campaigns-header {
    padding: 2rem 0 1rem;
}

.search-section {
    padding: 1rem 0 2rem;
}

/* Desktop Optimizations */
@media (min-width: 768px) {
    .campaign-image-full {
        height: 160px;
    }
    
    .campaign-content-full {
        padding: 12px;
    }
    
    .campaign-title-full {
        font-size: 1.2rem;
        margin-bottom: 10px;
    }
    
    .campaign-detail-grid {
        margin-bottom: 10px;
    }
    
    .detail-row {
        margin-bottom: 4px;
    }
    
    .campaign-description-full {
        padding: 8px;
        margin-bottom: 12px;
        font-size: 0.85rem;
    }
    
    .campaign-actions-row {
        margin-bottom: 12px;
        gap: 6px;
    }
    
    .btn-action {
        padding: 8px 12px;
        font-size: 0.8rem;
    }
    
    .progress-section-full {
        padding: 10px;
    }
    
    .progress-item-full {
        margin-bottom: 6px;
    }
    
    .progress-header {
        margin-bottom: 4px;
    }
    
    .progress-label,
    .progress-value {
        font-size: 0.75rem;
    }
    
    .progress-bar-full {
        height: 5px;
        margin-bottom: 3px;
    }
    
    .campaigns-header {
        padding: 1.5rem 0 0.5rem;
    }
    
    .search-section {
        padding: 0.5rem 0 1.5rem;
    }
    
    .campaign-container {
        padding-top: 1.5rem;
        padding-bottom: 0.5rem;
    }
    
    .campaign-container .row {
        row-gap: 12px;
    }
}

/* Simple Search Styles */
.campaign-header-simple {
    margin-bottom: 2rem;
}

.section-title {
    color: var(--text-primary);
    font-size: 2rem;
    font-weight: 700;
    margin-bottom: 0.5rem;
}

.section-subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
    margin-bottom: 0;
}

/* Side-by-side search inputs */
.search-inputs-row {
    display: flex;
    gap: 1rem;
    align-items: center;
}

.search-input-inline,
.location-input-inline {
    position: relative;
    flex: 1;
}

.search-input-inline input,
.location-input-inline input {
    width: 100%;
    padding: 0.75rem 1rem;
    padding-right: 2.5rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 0.95rem;
    background: var(--surface-color);
    transition: all 0.3s ease;
}

.search-input-inline input:focus,
.location-input-inline input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(44, 42, 76, 0.1);
}

.search-input-inline input.is-invalid,
.location-input-inline input.is-invalid {
    border-color: #dc3545;
    box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
}

.location-error {
    font-size: 0.875rem;
    margin-top: 0.25rem;
    padding: 0.5rem 0.75rem;
    border-radius: 6px;
    background-color: #f8d7da;
    border: 1px solid #f5c6cb;
    color: #721c24;
}

.alert-sm {
    padding: 0.375rem 0.75rem;
    font-size: 0.875rem;
}

/* Distance and location-aware styling */
.distance-info {
    margin-bottom: 0.5rem;
}

.distance-info .badge {
    font-size: 0.75rem;
    padding: 0.375rem 0.75rem;
    border-radius: 20px;
    font-weight: 600;
}

.bg-opacity-20 {
    background-opacity: 0.2 !important;
}

.location-active-indicator {
    color: #28a745 !important;
    animation: pulse 2s infinite;
}

@keyframes pulse {
    0% { opacity: 1; }
    50% { opacity: 0.5; }
    100% { opacity: 1; }
}

/* Campaign card enhancements */
.campaign-card {
    transition: all 0.3s ease;
    cursor: pointer;
}

.campaign-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 25px rgba(0,0,0,0.15);
}

.campaign-content {
    position: relative;
}

.btn-view-campaign {
    transition: all 0.3s ease;
}

.campaign-card:hover .btn-view-campaign {
    background: linear-gradient(135deg, var(--primary-color) 0%, var(--secondary-color) 100%);
    transform: translateX(2px);
}

.search-icon-inline,
.location-icon-inline {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    pointer-events: none;
}

.location-active-indicator {
    position: absolute;
    right: 2.5rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--success-color);
    font-size: 0.75rem;
}

/* Responsive */
@media (max-width: 768px) {
    .search-inputs-row {
        flex-direction: column;
        gap: 0.75rem;
    }
    
    .search-input-inline,
    .location-input-inline {
        width: 100%;
    }
}

.search-input-simple {
    position: relative;
    display: inline-block;
    width: 100%;
    max-width: 300px;
}

.search-input-simple input {
    width: 100%;
    padding: 0.75rem 1rem;
    padding-right: 2.5rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    font-size: 0.95rem;
    background: var(--surface-color);
    transition: all 0.3s ease;
}

.search-input-simple input:focus {
    outline: none;
    border-color: var(--primary-color);
    box-shadow: 0 0 0 3px rgba(44, 42, 76, 0.1);
}

.search-icon-simple {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-secondary);
    pointer-events: none;
}

.location-btn-simple {
    background: var(--primary-color);
    color: white;
    border: none;
    padding: 0.75rem 1.5rem;
    border-radius: var(--radius-md);
    font-size: 0.9rem;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    width: 100%;
    max-width: 300px;
    justify-content: center;
}

.location-btn-simple:hover {
    background: #1f1d3d;
    transform: translateY(-1px);
}

.location-btn-simple i {
    font-size: 0.9rem;
}

/* Loading and Error Message Styles */
.no-results-message,
.error-message {
    text-align: center;
    padding: 3rem 1.5rem;
    background: var(--surface-color);
    border-radius: var(--radius-lg);
    box-shadow: var(--shadow-sm);
    margin: 1rem 0;
}

.no-results-message i,
.error-message i {
    font-size: 3rem;
    color: var(--text-secondary);
    margin-bottom: 1rem;
    display: block;
}

.no-results-message h4,
.error-message h4 {
    color: var(--text-primary);
    margin-bottom: 0.5rem;
    font-weight: 600;
}

.no-results-message p,
.error-message p {
    color: var(--text-secondary);
    margin-bottom: 1.5rem;
    font-size: 1rem;
}

.error-message .btn {
    margin-top: 0.5rem;
}

/* Location indicator styles */
.location-active-indicator {
    color: var(--success-color);
    margin-left: 0.25rem;
    font-size: 0.75rem;
}

.location-badge {
 
}

.location-badge i {
    margin-right: 0.25rem;
}

/* Search loading styles */
.search-loading {
    position: absolute;
    right: 1rem;
    top: 50%;
    transform: translateY(-50%);
    color: var(--primary-color);
    font-size: 0.875rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
}

.search-loading i {
    animation: spin 1s linear infinite;
}

@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

/* Google Places Autocomplete Z-Index Fix */
.pac-container {
    z-index: 10000 !important;
    box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1) !important;
    border-radius: 8px !important;
    border: 1px solid var(--border-color) !important;
    background: white !important;
    margin-top: 2px !important;
    position: absolute !important;
}

.pac-item {
    padding: 12px 16px !important;
    border-bottom: 1px solid #f0f0f0 !important;
    cursor: pointer !important;
    font-size: 14px !important;
    transition: background-color 0.2s ease !important;
}

.pac-item:hover {
    background-color: #f8f9fa !important;
}

.pac-item:last-child {
    border-bottom: none !important;
    border-bottom-left-radius: 8px !important;
    border-bottom-right-radius: 8px !important;
}

.pac-icon {
    background-image: none !important;
    margin-right: 8px !important;
    width: 16px !important;
    height: 16px !important;
}

.pac-icon::before {
    content: "📍";
    font-size: 14px;
    line-height: 16px;
}

.pac-item-query {
    font-weight: 500 !important;
    color: var(--text-primary) !important;
}

.pac-matched {
    font-weight: 600 !important;
    color: var(--primary-color) !important;
}

/* Modal z-index adjustment */
.modal {
    z-index: 1050;
}

.modal-backdrop {
    z-index: 1040;
}

/* Location search container positioning */
.location-search-container {
    position: relative;
}

.location-search-input {
    position: relative;
    z-index: 1;
}

/* Ensure autocomplete appears above modal and other elements */
.pac-container {
    z-index: 10000 !important;
    position: absolute !important;
    display: block !important;
    background: white !important;
    border: 1px solid #ccc !important;
    border-radius: 4px !important;
    box-shadow: 0 2px 6px rgba(0,0,0,0.3) !important;
    margin-top: 2px !important;
    min-width: 200px !important;
}

.pac-item {
    padding: 10px !important;
    border-bottom: 1px solid #eee !important;
    cursor: pointer !important;
    font-family: inherit !important;
}

.pac-item:hover {
    background-color: #f0f0f0 !important;
}

.pac-matched {
    font-weight: bold !important;
    color: #1a73e8 !important;
}

/* Ensure location input is properly positioned */
#locationSearchInput {
    position: relative !important;
    z-index: 1 !important;
    background: white !important;
    border: 1px solid #ddd !important;
    border-radius: 8px !important;
}

/* Mobile Responsiveness */
@media (max-width: 768px) {
    .campaign-image-full {
        height: 160px;
    }

    .campaign-content-full {
        padding: 12px;
    }

    .campaign-title-full {
        font-size: 1.2rem;
    }

    .detail-row {
        flex-direction: column;
        gap: 8px;
    }

    .detail-item-full {
        font-size: 0.8rem;
    }

    .btn-action {
        padding: 10px 12px;
        font-size: 0.8rem;
    }

    .btn-action span {
        display: inline;
    }

    .campaign-actions-row {
        gap: 8px;
    }
}

@media (max-width: 576px) {
    .campaign-image-full {
        height: 180px;
    }

    .campaign-content-full {
        padding: 14px;
    }

    .campaign-title-full {
        font-size: 1.1rem;
        margin-bottom: 12px;
    }

    .campaign-actions-row {
        flex-direction: row;
        gap: 6px;
    }

    .btn-action {
        padding: 8px 10px;
        font-size: 0.75rem;
    }

    .progress-section-full {
        padding: 12px;
    }

    .progress-header {
        font-size: 0.8rem;
    }
}
</style>

<!-- Campaign Page Header -->
<section class="campaigns-header">
    <div class="container">
        <div class="row justify-content-center text-center">
            <div class="col-lg-8">
                <!-- <h1 class="fade-in">Medical Campaigns</h1> -->
                <p class="fade-in">Discover healthcare campaigns in your area and join thousands of patients receiving quality medical care</p>
            </div>
        </div>
    </div>
</section>

<!-- Success/Error Messages -->
@if(session('success'))
<div class="container mt-3">
    <div class="alert alert-success alert-dismissible fade show" role="alert">
        <i class="fas fa-check-circle me-2"></i>
        <strong>Success!</strong> {{ session('success') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
</div>
@endif

@if(session('error'))
<div class="container mt-3">
    <div class="alert alert-danger alert-dismissible fade show" role="alert">
        <i class="fas fa-exclamation-circle me-2"></i>
        <strong>Error!</strong> {{ session('error') }}
        <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
</div>
@endif

<!-- Campaigns Container -->
<section class="campaign-container">
    <div class="container">
        <div class="campaign-header-simple">
            <div class="row align-items-center mb-4">
                <div class="col-md-6">
                    <h2 class="section-title">Medical Campaigns</h2>
                    <p class="section-subtitle">Discover healthcare campaigns in your area</p>
                </div>
                <div class="col-md-6">
                    <div class="search-inputs-row">
                        <!-- Search Input -->
                        <div class="search-input-inline">
                            <input type="text" 
                                   id="campaignSearchMain"
                                   placeholder="Search campaigns by title, doctor, or specialty..."
                                   autocomplete="off">
                            <i class="fas fa-search search-icon-inline"></i>
                        </div>
                        <!-- Location Input -->
                        <div class="location-input-inline">
                            <input type="text" 
                                   id="locationSearchInput"
                                   placeholder="Your location for distance calculation..."
                                   autocomplete="off">
                            <i class="fas fa-map-marker-alt location-icon-inline"></i>
                            <span id="locationActiveIndicator" class="location-active-indicator" style="display: none;">
                                <i class="fas fa-check-circle"></i>
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Filter Modal -->
<div id="filterModal" class="filter-modal">
    <div class="modal-content-compact">
        <div class="modal-header-compact">
            <h3><i class="fas fa-filter me-2"></i>Filter Campaigns</h3>
            <button type="button" class="modal-close" onclick="closeFilterModal()">
                <i class="fas fa-times"></i>
            </button>
        </div>
        <div class="modal-body-compact">
            <form id="filterForm">
                <div class="filter-grid">
                    <div class="filter-item">
                        <label for="filterSpecialty">Specialty</label>
                        <select id="filterSpecialty" name="specialty">
                            <option value="">All Specialties</option>
                            @foreach($specialties ?? [] as $specialty)
                                <option value="{{ $specialty->id }}" {{ request('specialty') == $specialty->id ? 'selected' : '' }}>
                                    {{ $specialty->name }}
                                </option>
                            @endforeach
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filterType">Campaign Type</label>
                        <select id="filterType" name="type">
                            <option value="">All Types</option>
                            <option value="medical" {{ request('type') == 'medical' ? 'selected' : '' }}>Medical</option>
                            <option value="surgical" {{ request('type') == 'surgical' ? 'selected' : '' }}>Surgical</option>
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filterStatus">Status</label>
                        <select id="filterStatus" name="status">
                            <option value="">All Status</option>
                            <option value="upcoming" {{ request('status') == 'upcoming' ? 'selected' : '' }}>Upcoming</option>
                            <option value="ongoing" {{ request('status') == 'ongoing' ? 'selected' : '' }}>Ongoing</option>
                            <option value="completed" {{ request('status') == 'completed' ? 'selected' : '' }}>Completed</option>
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filterRegistration">Registration</label>
                        <select id="filterRegistration" name="registration">
                            <option value="">All Campaigns</option>
                            <option value="free" {{ request('registration') == 'free' ? 'selected' : '' }}>Free</option>
                            <option value="paid" {{ request('registration') == 'paid' ? 'selected' : '' }}>Paid</option>
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filterSort">Sort By</label>
                        <select id="filterSort" name="sort">
                            <option value="latest" {{ request('sort') == 'latest' ? 'selected' : '' }}>Latest</option>
                            <option value="upcoming" {{ request('sort') == 'upcoming' ? 'selected' : '' }}>Upcoming First</option>
                            <option value="popular" {{ request('sort') == 'popular' ? 'selected' : '' }}>Most Popular</option>
                        </select>
                    </div>
                    
                    <div class="filter-item">
                        <label for="filterDoctor">Doctor Name</label>
                        <input type="text" 
                               id="filterDoctor" 
                               name="doctor"
                               placeholder="Enter doctor name..."
                               value="{{ request('doctor') }}">
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer-compact">
            <button type="button" onclick="clearFilters()" class="btn btn-outline-danger">Clear All</button>
            <button type="button" onclick="closeFilterModal()" class="btn btn-secondary">Cancel</button>
            <button type="button" id="applyFiltersBtn" class="btn btn-primary">Apply Filters</button>
        </div>
    </div>
</div>

<!-- Campaigns Grid -->
<section class="campaigns-grid campaign-container" style="margin-top:0;padding-top:0;">
    <div class="container">
        @if(isset($campaigns) && $campaigns->count() > 0)
            <!-- Results Info -->
            <div class="row mb-2">
                <div class="col-12">
                    <div class="d-flex justify-content-between align-items-center">
                        <h5 class="mb-0">
                            Showing {{ $campaigns->firstItem() }} - {{ $campaigns->lastItem() }} of {{ $campaigns->total() }} campaigns
                        </h5>
                        <div class="text-muted">
                            Page {{ $campaigns->currentPage() }} of {{ $campaigns->lastPage() }}
                        </div>
                    </div>
                </div>
            </div>

            <div class="row" id="campaignsGrid">
                @forelse($campaigns as $campaign)
                    @php
                        $today = now();
                        $status = 'upcoming';
                        if ($campaign->start_date <= $today && $campaign->end_date >= $today) {
                            $status = 'ongoing';
                        } elseif ($campaign->end_date < $today) {
                            $status = 'completed';
                        }
                        
                        // Calculate registration progress - optimized
                        $totalRegistered = $campaign->total_registered ?? $campaign->patientRegistrations->count();
                        $expectedPatients = $campaign->expected_patients ?? 100;
                        $registrationProgress = $expectedPatients > 0 ? round(($totalRegistered / $expectedPatients) * 100) : 0;
                        
                        // Calculate sponsorship progress - optimized
                        $sponsorCollection = $campaign->campaignSponsors ?? $campaign->sponsors ?? collect();
                        $totalSponsored = $campaign->total_sponsored ?? $sponsorCollection->where('payment_status', 'success')->sum('amount');
                        $sponsorshipTarget = $campaign->target_amount ?? $campaign->amount ?? 10000;
                        $sponsorshipProgress = $sponsorshipTarget > 0 ? round(($totalSponsored / $sponsorshipTarget) * 100) : 0;
                        
                        $registrationFee = $campaign->registration_payment ?? 0;
                        $isFree = $registrationFee == 0;
                    @endphp
                    
                    <div class="col-md-6 col-lg-4 campaign-item fade-in"
                         data-title="{{ strtolower($campaign->title) }}"
                         data-location="{{ strtolower($campaign->location) }}"
                         data-type="{{ $campaign->camp_type ?? '' }}"
                         data-doctor="{{ strtolower($campaign->doctor->doctor_name ?? '') }}"
                         data-specializations="{{ $campaign->doctor && $campaign->doctor->specialty ? strtolower($campaign->doctor->specialty->name) : '' }}"
                         data-lat="{{ $campaign->latitude ?? (18.5204 + (rand(-100, 100) / 1000)) }}" 
                         data-lng="{{ $campaign->longitude ?? (73.8567 + (rand(-100, 100) / 1000)) }}">

                        <div class="campaign-card compact-layout">
                            <!-- Campaign Image/Video (Full Width) -->
                            @php
                                $campaignUrl = route('user.campaigns.view', $campaign->id);
                                // Only add referral if user is authenticated and doesn't already have ref parameter
                                if(auth('user')->check() && auth('user')->user()->your_referral_id && !str_contains($campaignUrl, '?ref=')) {
                                    $campaignUrl .= '?ref=' . auth('user')->user()->your_referral_id;
                                }
                            @endphp
                            <div class="campaign-image-full" onclick="window.location.href='{{ $campaignUrl }}'" style="cursor: pointer;">
                                @if($campaign->video_link && (str_contains($campaign->video_link, 'http://') || str_contains($campaign->video_link, 'https://')))
                                    <!-- External Video Link -->
                                    @if(str_contains($campaign->video_link, 'youtube.com') || str_contains($campaign->video_link, 'youtu.be'))
                                        @php
                                            $videoId = '';
                                            if (str_contains($campaign->video_link, 'youtu.be/')) {
                                                $videoId = substr($campaign->video_link, strrpos($campaign->video_link, '/') + 1);
                                            } elseif (str_contains($campaign->video_link, 'youtube.com/watch?v=')) {
                                                parse_str(parse_url($campaign->video_link, PHP_URL_QUERY), $params);
                                                $videoId = $params['v'] ?? '';
                                            }
                                        @endphp
                                        <div class="video-container-full">
                                            <iframe src="https://www.youtube.com/embed/{{ $videoId }}" frameborder="0" allowfullscreen></iframe>
                                            <div class="video-overlay">
                                                <i class="fas fa-play-circle"></i>
                                            </div>
                                        </div>
                                    @elseif(str_contains($campaign->video_link, 'vimeo.com'))
                                        @php
                                            $videoId = substr($campaign->video_link, strrpos($campaign->video_link, '/') + 1);
                                        @endphp
                                        <div class="video-container-full">
                                            <iframe src="https://player.vimeo.com/video/{{ $videoId }}" frameborder="0" allowfullscreen></iframe>
                                            <div class="video-overlay">
                                                <i class="fas fa-play-circle"></i>
                                            </div>
                                        </div>
                                    @else
                                        <div class="external-video-full">
                                            <i class="fas fa-external-link-alt"></i>
                                            <p>External Video</p>
                                        </div>
                                    @endif
                                @elseif($campaign->video && !str_contains($campaign->video, 'http'))
                                    <!-- Uploaded Video File -->
                                    <div class="video-container-full">
                                        <video controls>
                                            <source src="{{ asset('storage/' . $campaign->video) }}" type="video/mp4">
                                            Your browser does not support the video tag.
                                        </video>
                                    </div>
                                @elseif($campaign->thumbnail)
                                    @if(str_contains($campaign->thumbnail, 'http://') || str_contains($campaign->thumbnail, 'https://'))
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E" 
                                             data-src="{{ $campaign->thumbnail }}" 
                                             alt="{{ $campaign->title }}" 
                                             class="campaign-image-responsive lazy-load"
                                             loading="lazy">
                                    @else
                                        <img src="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='300' height='200'%3E%3Crect width='100%25' height='100%25' fill='%23f0f0f0'/%3E%3C/svg%3E" 
                                             data-src="{{ asset('storage/' . $campaign->thumbnail) }}" 
                                             alt="{{ $campaign->title }}" 
                                             class="campaign-image-responsive lazy-load"
                                             loading="lazy">
                                    @endif
                                @else
                                    <div class="d-flex align-items-center justify-content-center h-100 campaign-placeholder">
                                        <div class="text-center">
                                            <i class="fas fa-calendar-medical" style="font-size: 3rem; margin-bottom: 1rem; color: #667eea;"></i>
                                            <h5 style="color: #2C2A4C; margin: 0; font-weight: 600;">{{ $campaign->title }}</h5>
                                            <p style="color: #6c757d; margin: 0.5rem 0 0 0; font-size: 0.9rem;">Medical Camp</p>
                                        </div>
                                    </div>
                                @endif

                                <!-- Distance Badge (Always visible with calculated distance) -->
                                @if(isset($campaign->distance_km) && $campaign->distance_km !== null)
                                    <span class="location-badge full-width-badge {{ $campaign->distance_class ?? 'distance-very-near' }}">
                                        <i class="fas fa-map-marker-alt"></i>
                                        <span class="distance-text">{{ $campaign->distance_text }}</span>
                                    </span>
                                @endif
                                
                                <!-- Registration Cost Badge -->
                                @if($campaign->registration_payment && $campaign->registration_payment > 0)
                                    <span class="cost-badge full-width-cost-badge cost-paid">
                                        @if($campaign->original_price && $campaign->original_price > $campaign->registration_payment)
                                            <i class="fas fa-percentage me-1"></i>DISCOUNT
                                        @else
                                            <i class="fas fa-rupee-sign me-1"></i>₹{{ number_format($campaign->registration_payment) }}
                                        @endif
                                    </span>
                                @else
                                    <span class="cost-badge full-width-cost-badge cost-free">
                                        <i class="fas fa-gift me-1"></i>FREE
                                    </span>
                                @endif
                            </div>

                            <!-- Campaign Content (Full Width Below Image) -->
                            <div class="campaign-content-full">
                                <!-- Title -->
                                <h4 class="campaign-title-full" onclick="window.location.href='{{ $campaignUrl }}'" style="cursor: pointer;">{{ $campaign->title }}</h4>
                                
                                <!-- Doctor and Specialty Info -->
                                <div class="campaign-detail-grid">
                                    <div class="detail-row">
                                        <div class="detail-item-full compact-detail">
                                            <i class="fas fa-user-md text-primary"></i>
                                            <span>{{ $campaign->doctor ? $campaign->doctor->doctor_name : 'TBA' }}</span>
                                        </div>
                                        @if($campaign->doctor && $campaign->doctor->specialty)
                                        <div class="detail-item-full compact-detail">
                                            <i class="fas fa-stethoscope text-success"></i>
                                            <span>{{ $campaign->doctor->specialty->name }}</span>
                                        </div>
                                        @endif
                                    </div>
                                    
                                    <div class="detail-row">
                                        <div class="detail-item-full compact-detail">
                                            <i class="fas fa-calendar text-warning"></i>
                                            <span>{{ \Carbon\Carbon::parse($campaign->start_date)->format('M d') }} - {{ \Carbon\Carbon::parse($campaign->end_date)->format('M d, Y') }}</span>
                                        </div>
                                        @if($campaign->start_time && $campaign->end_time)
                                        <div class="detail-item-full compact-detail">
                                            <i class="fas fa-clock text-info"></i>
                                            <span>{{ \Carbon\Carbon::parse($campaign->start_time)->format('g:i A') }} - {{ \Carbon\Carbon::parse($campaign->end_time)->format('g:i A') }}</span>
                                        </div>
                                        @endif
                                    </div>

                                    @if($campaign->location)
                                    <div class="detail-row">
                                        <div class="detail-item-full location-full">
                                            <i class="fas fa-map-marker-alt text-danger"></i>
                                            <span>{{ $campaign->location }}</span>
                                        </div>
                                    </div>
                                    @endif
                                </div>

                                <!-- Description -->
                                @if($campaign->description)
                                    <div class="campaign-description-full">
                                        {{ strlen($campaign->description) > 120 ? substr($campaign->description, 0, 120) . '...' : $campaign->description }}
                                    </div>
                                @endif

                                <!-- Action Buttons Row -->
                                <div class="campaign-actions-row">
                                    @if($status === 'completed')
                                        <button class="btn-action btn-register-full" disabled>
                                            <i class="fas fa-clock"></i>
                                            <span>Closed</span>
                                        </button>
                                    @else
                                        @auth('user')
                                            <a href="{{ route('user.campaigns.register', $campaign->id) }}" class="btn-action btn-register-full">
                                                <i class="fas fa-user-plus"></i>
                                                <span>Register</span>
                                            </a>
                                        @else
                                            <a href="javascript:void(0)" onclick="handleLoginPrompt('register', '{{ route('user.campaigns.register', $campaign->id) }}')" class="btn-action btn-register-full">
                                                <i class="fas fa-user-plus"></i>
                                                <span>Register</span>
                                            </a>
                                        @endauth
                                    @endif
                                    
                                    <a href="{{ route('user.campaigns.sponsor', $campaign->id) }}" class="btn-action btn-sponsor-full">
                                        <i class="fas fa-hand-holding-heart"></i>
                                        <span>Sponsor</span>
                                    </a>

                                    <button onclick="shareEnhancedCampaign('{{ $campaign->id }}', '{{ $campaignUrl }}', {{ json_encode($campaign->title) }}, {{ json_encode($campaign->description) }}, '{{ $campaign->thumbnail ? asset('storage/' . $campaign->thumbnail) : '' }}')" class="btn-action btn-share-full">
                                        <i class="fas fa-share-alt"></i>
                                        <span>Share</span>
                                    </button>
                                </div>

                                <!-- Progress Bars Section -->
                                <div class="progress-section-full">
                                    <!-- Registration Progress -->
                                    <div class="progress-item-full">
                                        <div class="progress-header">
                                            <span class="progress-label">Registration Progress</span>
                                            <span class="progress-value">{{ $totalRegistered }}/{{ $expectedPatients }}</span>
                                        </div>
                                        <div class="progress-bar-full">
                                            <div class="progress-fill registration-progress" style="width: {{ $registrationProgress }}%"></div>
                                        </div>
                                        <div class="progress-percentage">{{ $registrationProgress }}% Complete</div>
                                    </div>
                                    
                                    <!-- Sponsorship Progress -->
                                    <div class="progress-item-full">
                                        <div class="progress-header">
                                            <span class="progress-label">Funding Progress</span>
                                            <span class="progress-value">₹{{ number_format($totalSponsored) }}</span>
                                        </div>
                                        <div class="progress-bar-full">
                                            <div class="progress-fill sponsorship-progress" style="width: {{ $sponsorshipProgress }}%"></div>
                                        </div>
                                        <div class="progress-percentage">{{ $sponsorshipProgress }}% Funded</div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                @empty
                    <div class="col-12">
                        <div class="no-campaigns text-center py-5">
                            <i class="fas fa-calendar-times" style="font-size: 4rem; color: #ccc; margin-bottom: 1rem;"></i>
                            <h3>No Campaigns Available</h3>
                            <p>There are currently no approved campaigns. Please check back later or contact support.</p>
                        </div>
                    </div>
                @endforelse
            </div>

            <!-- Pagination -->
            <div class="pagination-wrapper">
                <div class="container">
                    <div class="row">
                        <div class="col-12 d-flex justify-content-center">
                            {{ $campaigns->appends(request()->query())->links('pagination::bootstrap-4') }}
                        </div>
                    </div>
                    
                    <!-- Pagination Info -->
                    <div class="row mt-3">
                        <div class="col-12 text-center">
                            <div class="text-muted">
                                <small>
                                    Showing {{ $campaigns->firstItem() }} to {{ $campaigns->lastItem() }} of {{ $campaigns->total() }} results
                                    @if($campaigns->hasPages())
                                        (Page {{ $campaigns->currentPage() }} of {{ $campaigns->lastPage() }})
                                    @endif
                                </small>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

        @else
            <!-- No Results -->
            <div class="no-results">
                <i class="fas fa-search"></i>
                <h3>No Campaigns Found</h3>
                <p>
                    @if(request()->hasAny(['search', 'location', 'specialty', 'type', 'status', 'registration']))
                        No campaigns match your current search criteria. Try adjusting your filters.
                    @else
                        There are currently no active campaigns available.
                    @endif
                </p>
                @if(request()->hasAny(['search', 'location', 'specialty', 'type', 'status', 'registration']))
                    <a href="{{ route('user.campaigns') }}" class="btn-primary mt-3">
                        <i class="fas fa-refresh me-2"></i>
                        View All Campaigns
                    </a>
                @endif
            </div>
        @endif
    </div>
</section>

<!-- Healthcare Stats Section -->
<section class="stats-section">
    <div class="container">
        <div class="row text-center">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-hospital"></i>
                    </div>
                    <div class="stat-number" id="totalCampaigns">{{ \App\Models\Campaign::count() }}</div>
                    <div class="stat-label">Total Campaigns</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <div class="stat-number" id="totalDoctors">{{ \App\Models\Doctor::count() }}</div>
                    <div class="stat-label">Verified Doctors</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-users"></i>
                    </div>
                    <div class="stat-number" id="totalPatients">{{ \App\Models\PatientRegistration::count() }}</div>
                    <div class="stat-label">Patients Served</div>
                </div>
            </div>
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="stat-card">
                    <div class="stat-icon">
                        <i class="fas fa-heart"></i>
                    </div>
                    <div class="stat-number" id="activeCampaigns">{{ \App\Models\Campaign::where('approval_status', 'approved')->whereDate('end_date', '>=', now())->count() }}</div>
                    <div class="stat-label">Active Campaigns</div>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- How Campaigns Work Section -->
<section class="how-it-works-section" style="padding: 4rem 0; background: var(--white);">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 style="color: var(--primary-color); font-weight: 700; margin-bottom: 1rem;">How Medical Campaigns Work</h2>
                <p style="color: var(--text-muted); font-size: 1.1rem;">Join thousands of patients who have benefited from our healthcare campaigns</p>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center" style="padding: 2rem;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--primary-color), #4a47a3); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-search"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">1. Browse Campaigns</h4>
                    <p style="color: var(--text-muted);">Search medical campaigns by title, doctor, or specialty. Location helps calculate distances to show how far each campaign is from you.</p>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center" style="padding: 2rem;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--secondary-color), #d4751a); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-user-plus"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">2. Register Online</h4>
                    <p style="color: var(--text-muted);">Complete a simple registration form and make payment if required. Many campaigns are completely free.</p>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center" style="padding: 2rem;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--success-color), #45a049); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-calendar-check"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">3. Attend Campaign</h4>
                    <p style="color: var(--text-muted);">Visit the campaign location on the scheduled date and receive quality medical care from verified doctors.</p>
                </div>
            </div>
            
            <div class="col-lg-3 col-md-6 mb-4">
                <div class="text-center" style="padding: 2rem;">
                    <div style="width: 80px; height: 80px; background: linear-gradient(135deg, var(--info-color), #1976D2); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; color: white; font-size: 2rem;">
                        <i class="fas fa-heart"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">4. Get Follow-up</h4>
                    <p style="color: var(--text-muted);">Receive follow-up care instructions and access to ongoing medical support through our platform.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Benefits Section -->
<section class="benefits-section" style="padding: 4rem 0; background: var(--light-gray);">
    <div class="container">
        <div class="row text-center mb-5">
            <div class="col-12">
                <h2 style="color: var(--primary-color); font-weight: 700; margin-bottom: 1rem;">Why Choose Our Medical Campaigns</h2>
                <p style="color: var(--text-muted); font-size: 1.1rem;">Experience quality healthcare with these unique advantages</p>
            </div>
        </div>
        
        <div class="row">
            <div class="col-lg-4 col-md-6 mb-4">
                <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); height: 100%; transition: transform 0.3s ease; border: 1px solid var(--border-color);" 
                     onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='var(--shadow-lg)'" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
                    <div style="color: var(--primary-color); font-size: 2.5rem; margin-bottom: 1rem;">
                        <i class="fas fa-user-md"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">Verified Doctors</h4>
                    <p style="color: var(--text-muted); line-height: 1.6;">All participating doctors are thoroughly verified, licensed professionals with proven expertise in their medical specialties.</p>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4">
                <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); height: 100%; transition: transform 0.3s ease; border: 1px solid var(--border-color);" 
                     onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='var(--shadow-lg)'" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
                    <div style="color: var(--success-color); font-size: 2.5rem; margin-bottom: 1rem;">
                        <i class="fas fa-money-bill-wave"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">Affordable Care</h4>
                    <p style="color: var(--text-muted); line-height: 1.6;">Access premium healthcare services at significantly reduced costs through our corporate sponsorship programs and partnerships.</p>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4">
                <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); height: 100%; transition: transform 0.3s ease; border: 1px solid var(--border-color);" 
                     onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='var(--shadow-lg)'" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
                    <div style="color: var(--warning-color); font-size: 2.5rem; margin-bottom: 1rem;">
                        <i class="fas fa-shield-alt"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">Quality Assurance</h4>
                    <p style="color: var(--text-muted); line-height: 1.6;">Every campaign is monitored for quality standards and compliance with medical regulations and safety protocols.</p>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4">
                <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); height: 100%; transition: transform 0.3s ease; border: 1px solid var(--border-color);" 
                     onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='var(--shadow-lg)'" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
                    <div style="color: var(--info-color); font-size: 2.5rem; margin-bottom: 1rem;">
                        <i class="fas fa-clock"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">24/7 Support</h4>
                    <p style="color: var(--text-muted); line-height: 1.6;">Round-the-clock customer support and emergency assistance for all campaign participants and registered users.</p>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4">
                <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); height: 100%; transition: transform 0.3s ease; border: 1px solid var(--border-color);" 
                     onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='var(--shadow-lg)'" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
                    <div style="color: var(--secondary-color); font-size: 2.5rem; margin-bottom: 1rem;">
                        <i class="fas fa-map-marked-alt"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">Wide Coverage</h4>
                    <p style="color: var(--text-muted); line-height: 1.6;">Healthcare campaigns across multiple cities and regions, bringing medical care closer to your location.</p>
                </div>
            </div>
            
            <div class="col-lg-4 col-md-6 mb-4">
                <div style="background: var(--white); padding: 2rem; border-radius: var(--radius-lg); box-shadow: var(--shadow-sm); height: 100%; transition: transform 0.3s ease; border: 1px solid var(--border-color);" 
                     onmouseover="this.style.transform='translateY(-8px)'; this.style.boxShadow='var(--shadow-lg)'" 
                     onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='var(--shadow-sm)'">
                    <div style="color: var(--danger-color); font-size: 2.5rem; margin-bottom: 1rem;">
                        <i class="fas fa-certificate"></i>
                    </div>
                    <h4 style="color: var(--primary-color); margin-bottom: 1rem;">Certified Platform</h4>
                    <p style="color: var(--text-muted); line-height: 1.6;">Government approved and certified platform ensuring compliance with healthcare regulations and standards.</p>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Call to Action Section -->
<section class="cta-section" style="padding: 4rem 0; background: linear-gradient(135deg, var(--primary-color) 0%, #4a47a3 100%); color: var(--white);">
    <div class="container">
        <div class="row text-center">
            <div class="col-lg-8 mx-auto">
                <h2 style="font-weight: 700; margin-bottom: 1rem; font-size: 2.5rem;">Ready to Get Quality Healthcare?</h2>
                <p style="font-size: 1.2rem; margin-bottom: 2rem; opacity: 0.9;">Join thousands of satisfied patients who have experienced quality medical care through our campaigns.</p>
                <div class="d-flex gap-3 justify-content-center flex-wrap">
                    <a href="{{ route('user.campaigns') }}" style="background: var(--secondary-color); color: var(--white); padding: 1rem 2rem; border-radius: var(--radius-md); text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem;" 
                       onmouseover="this.style.background='#d4751a'; this.style.transform='translateY(-2px)'" 
                       onmouseout="this.style.background='var(--secondary-color)'; this.style.transform='translateY(0)'">
                        <i class="fas fa-search"></i>
                        Browse All Campaigns
                    </a>
                    <a href="{{ route('user.register') }}" style="background: transparent; color: var(--white); padding: 1rem 2rem; border: 2px solid var(--white); border-radius: var(--radius-md); text-decoration: none; font-weight: 600; transition: all 0.3s ease; display: inline-flex; align-items: center; gap: 0.5rem;" 
                       onmouseover="this.style.background='var(--white)'; this.style.color='var(--primary-color)'" 
                       onmouseout="this.style.background='transparent'; this.style.color='var(--white)'">
                        <i class="fas fa-user-plus"></i>
                        Join FreeDoctor
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<!-- Registration Modal -->
<div id="registrationModal" class="modal" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h2><i class="fas fa-user-plus me-2"></i>Register for Campaign</h2>
            <button class="close" onclick="closeRegistrationModal()">&times;</button>
        </div>
        <div class="modal-body">
            <form id="registrationForm">
                @csrf
                <input type="hidden" name="campaign_id" id="campaignId">
                <input type="hidden" name="user_id" id="userId" value="{{ auth('user')->id() }}">
                <input type="hidden" name="amount" id="amount">

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>Full Name</label>
                            <input type="text" name="name" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>Email Address</label>
                            <input type="email" name="email" class="form-control" required>
                        </div>
                    </div>
                </div>

                <div class="row">
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>Phone Number</label>
                            <input type="tel" name="phone_number" class="form-control" required>
                        </div>
                    </div>
                    <div class="col-md-6">
                        <div class="form-group mb-3">
                            <label>Age</label>
                            <input type="number" name="age" class="form-control" min="1" max="120">
                        </div>
                    </div>
                </div>

                <div class="form-group mb-3">
                    <label>Address</label>
                    <textarea name="address" class="form-control" rows="3" required></textarea>
                </div>

                <!-- Payment Information -->
                <div id="paymentInfo" class="payment-info" style="display: none;">
                    <div class="alert alert-info">
                        <h5><i class="fas fa-credit-card me-2"></i>Payment Required</h5>
                        <p>Registration fee: <strong id="paymentAmount">₹0</strong></p>
                        <p>You will be redirected to a secure payment gateway to complete your registration.</p>
                    </div>
                </div>

                <div id="freeInfo" class="payment-info" style="display: none;">
                    <div class="alert alert-success">
                        <h5><i class="fas fa-check-circle me-2"></i>Free Registration</h5>
                        <p>This campaign is free to join. Click below to complete your registration.</p>
                    </div>
                </div>

                <div class="d-flex gap-3 mt-4">
                    <button type="button" onclick="closeRegistrationModal()" class="btn btn-secondary flex-1">Cancel</button>
                    <button type="submit" id="freeRegisterBtn" class="btn btn-success flex-1" style="display: none;">
                        <i class="fas fa-user-plus me-2"></i>Register Free
                    </button>
                    <button type="button" id="paymentBtn" class="btn btn-primary flex-1" style="display: none;">
                        <i class="fas fa-credit-card me-2"></i><span id="paymentBtnText">Pay Now</span>
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>

@endsection

@push('scripts')
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
<script src="https://checkout.razorpay.com/v1/checkout.js"></script>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<!-- Add Google Maps Places API for location services -->
<script>
// Global Google Maps callback functions
window.handleGoogleMapsLoad = function() {
    debugLog('Google Maps loaded successfully');
    googleMapsLoaded = true;
    
    // Initialize Places Autocomplete
    initializePlacesAutocomplete();
}

window.handleGoogleMapsError = function() {
    errorLog('Google Maps failed to load');
    googleMapsLoaded = false;
}

// Load Google Maps script dynamically with proper async loading
function loadGoogleMaps() {
    if (window.google && window.google.maps) {
        debugLog('Google Maps already loaded');
        window.handleGoogleMapsLoad();
        return;
    }
    
    debugLog('Loading Google Maps API...');
    const script = document.createElement('script');
    script.src = `https://maps.googleapis.com/maps/api/js?key=AIzaSyAaAGMxei5r_4i_3Yw2LBNLtu56KE5mVek&libraries=places&callback=handleGoogleMapsLoad&loading=async`;
    script.async = true;
    script.defer = true;
    script.onerror = window.handleGoogleMapsError;
    document.head.appendChild(script);
}
</script>

<script>
// ===== GLOBAL VARIABLES =====
let userLatitude = null;
let userLongitude = null;
let isUserLoggedIn = @json(auth('user')->check());
let searchTimeout = null;
let googleMapsLoaded = false;
let allCampaignsData = [];
let originalCampaignsHtml = '';
let lastSearchQuery = '';

// Pune coordinates as fallback
const puneCoordinates = {
    lat: 18.5204,
    lng: 73.8567
};

// ===== UTILITY FUNCTIONS =====
function debugLog(message, data = null) {
    // Only log in development mode
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log(`[Campaign Search] ${message}`, data || '');
    }
}

function successLog(message, data = null) {
    // Only log in development mode  
    if (window.location.hostname === 'localhost' || window.location.hostname === '127.0.0.1') {
        console.log(`✅ [Campaign Search] ${message}`, data || '');
    }
}

function errorLog(message, error = null) {
    console.error(`❌ [Campaign Search] ${message}`, error || '');
}

function getCSRFToken() {
    return document.querySelector('meta[name="csrf-token"]')?.getAttribute('content') || '';
}

// ===== LOCATION FUNCTIONS =====
function requestLocationPermission() {
    debugLog('Requesting location permission automatically');
    
    if (!navigator.geolocation) {
        errorLog('Geolocation is not supported by this browser');
        updateLocationDisplay('Location not supported');
        loadCampaignsWithoutLocation();
        return;
    }

    const options = {
        enableHighAccuracy: true,
        timeout: 10000,
        maximumAge: 300000 // 5 minutes
    };

    navigator.geolocation.getCurrentPosition(
        (position) => {
            userLatitude = position.coords.latitude;
            userLongitude = position.coords.longitude;
            successLog('Location obtained automatically', { lat: userLatitude, lng: userLongitude });
            
            // Update location display with user's current location
            updateLocationDisplay('Your Location');
            
            // Load location-based campaigns
            loadLocationBasedCampaigns();
        },
        (error) => {
            errorLog('Location permission denied or error occurred', error.message);
            
            // Update location display to show location not available
            updateLocationDisplay('Set Location');
            
            // Load campaigns without location (no distance calculation)
            loadCampaignsWithoutLocation();
        },
        options
    );
}

function updateLocationDisplay(locationText = null) {
    const locationButtonText = document.getElementById('locationButtonText');
    const locationIndicator = document.getElementById('locationActiveIndicator');
    
    if (locationText) {
        if (locationButtonText) {
            locationButtonText.textContent = locationText;
        }
        
        // Show indicator if location is set
        if (locationText !== 'Set Location' && locationIndicator) {
            locationIndicator.style.display = 'inline-block';
        } else if (locationIndicator) {
            locationIndicator.style.display = 'none';
        }
    } else if (userLatitude && userLongitude) {
        if (locationButtonText) {
            locationButtonText.textContent = 'Your Location';
        }
        if (locationIndicator) {
            locationIndicator.style.display = 'inline-block';
        }
    }
}

// ===== CAMPAIGN LOADING FUNCTIONS =====
function loadLocationBasedCampaigns() {
    debugLog('Loading location-based campaigns');
    performLocationBasedSearch('', '');
}

function loadCampaignsWithoutLocation() {
    debugLog('Loading campaigns without location');
    performLocationBasedSearch('', '');
}

function performLocationBasedSearch(searchQuery = '', locationQuery = '') {
    try {
        // Show loading state
        showSearchLoading(true);
        
        // Prepare search data
        const searchData = {
            search: searchQuery,
            location: locationQuery,
            latitude: userLatitude || puneCoordinates.lat,
            longitude: userLongitude || puneCoordinates.lng,
            update_user_location: isUserLoggedIn,
            _token: getCSRFToken()
        };
        
        // Create cache key for this search
        const cacheKey = `search_${JSON.stringify(searchData)}`;
        
        // Make cached AJAX request
        cachedFetch('/user/search-campaigns', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': getCSRFToken(),
                'Accept': 'application/json'
            },
            body: JSON.stringify(searchData)
        }, cacheKey)
        .then(data => {
            // Check if there's an error response
            if (!data.success) {
                if (data.error_type === 'invalid_location') {
                    handleLocationValidationError(data);
                } else {
                    handleSearchError(new Error(data.message), searchQuery);
                }
                return;
            }
            
            handleSearchSuccess(data, searchQuery);
        })
        .catch(error => {
            console.error('Search request failed:', error);
            handleSearchError(error, searchQuery);
        });
        
    } catch (error) {
        console.error('🔍 Step ERROR: Exception in performLocationBasedSearch:', error);
        handleSearchError(error, searchQuery);
    }
}

function handleSearchSuccess(data, searchQuery) {    
    try {
        // Hide loading state
        showSearchLoading(false);
        
        // Store last search query
        lastSearchQuery = searchQuery;
        
        // Display results
        displaySearchResults(data);
        
    } catch (error) {
        console.error('Error handling search success:', error);
        handleSearchError(error, searchQuery);
    }
}

function handleSearchError(error, searchQuery) {
    console.error('🔍 Step ERROR: Search error occurred:', error);
    
    // Hide loading state
    showSearchLoading(false);
    
    // Show error message
    displaySearchError('Unable to search campaigns. Please try again.');
}

function handleLocationValidationError(data) {
    console.log('🔍 Location validation error:', data.location_error);
    
    // Hide loading state
    showSearchLoading(false);
    
    // Show location-specific error below the location input
    const locationInput = document.getElementById('locationSearchInput');
    if (locationInput) {
        // Remove any existing error messages
        const existingError = locationInput.parentElement.querySelector('.location-error');
        if (existingError) {
            existingError.remove();
        }
        
        // Create and show error message
        const errorDiv = document.createElement('div');
        errorDiv.className = 'location-error alert alert-danger alert-sm mt-2';
        errorDiv.innerHTML = `
            <i class="fas fa-exclamation-triangle me-2"></i>
            ${data.message || 'Please select a valid location from the dropdown suggestions.'}
        `;
        
        // Insert error message after the location input
        locationInput.parentElement.appendChild(errorDiv);
        
        // Add error styling to input
        locationInput.classList.add('is-invalid');
        
        // Auto-remove error after 5 seconds
        setTimeout(() => {
            if (errorDiv && errorDiv.parentElement) {
                errorDiv.remove();
                locationInput.classList.remove('is-invalid');
            }
        }, 5000);
    }
    
    // Don't display any results for invalid location
    console.log('🔍 Not displaying results due to invalid location');
}

function handleSearchError(error, searchQuery) {
    errorLog('Handling search error:', error);
    
    // Hide loading state
    showSearchLoading(false);
    
    // Show error message
    displaySearchError('Unable to search campaigns. Please try again.');
}

function displayLocationBasedResults(data, locationQuery) {
    console.log('🗺️ Step 10: Displaying location-based results for:', locationQuery);
    console.log('🗺️ Data structure:', Object.keys(data));
    
    // Target the specific campaigns grid container
    let campaignsContainer = document.querySelector('#campaignsGrid');
    console.log('🗺️ Campaigns container (#campaignsGrid) found:', !!campaignsContainer);
    
    if (!campaignsContainer) {
        console.error('🗺️ ERROR: #campaignsGrid container not found, trying fallback');
        campaignsContainer = document.querySelector('.campaigns-grid .container .row');
        if (campaignsContainer) {
            console.log('🗺️ Using fallback container (.campaigns-grid .container .row)');
        } else {
            console.error('🗺️ ERROR: No suitable container found');
            return;
        }
    }
    
    try {
        if (data.campaigns && data.campaigns.length > 0) {
            console.log('🗺️ Step 11: Building HTML for', data.campaigns.length, 'location-based campaigns');
            
            // Add location context header
            let resultsHtml = `
                <div class="col-12 mb-4">
                    <div class="alert alert-info border-0" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                        <div class="d-flex align-items-center">
                            <i class="fas fa-map-marker-alt me-3" style="font-size: 1.5rem;"></i>
                            <div>
                                <h5 class="mb-1">
                                    <i class="fas fa-search me-2"></i>
                                    Campaigns near "${locationQuery}"
                                </h5>
                                <p class="mb-0 opacity-75">
                                    Found ${data.campaigns.length} campaign${data.campaigns.length !== 1 ? 's' : ''} 
                                    ${data.location_info && data.location_info.coords_source === 'provided' ? 'based on your selected location' : 'in this area'}
                                </p>
                            </div>
                        </div>
                    </div>
                </div>
            `;
            
            // Build campaigns HTML with distance information
            data.campaigns.forEach((campaign, index) => {
                console.log(`🗺️ Processing campaign ${index + 1}:`, campaign.title, `(${campaign.distance_text || 'Distance unknown'})`);
                resultsHtml += createLocationAwareCampaignCardHtml(campaign);
            });
            
            console.log('🗺️ Step 12: Setting location-based campaigns HTML in container');
            campaignsContainer.innerHTML = resultsHtml;
            console.log('🗺️ ✅ Successfully displayed', data.campaigns.length, 'location-based campaigns');
            
        } else {
            console.log('🗺️ Step 11: No campaigns found near location, showing no results message');
            // No campaigns found near this location
            campaignsContainer.innerHTML = `
                <div class="col-12">
                    <div class="text-center p-5">
                        <div class="mb-4">
                            <i class="fas fa-map-marker-alt text-muted mb-3" style="font-size: 3rem;"></i>
                            <h4>No campaigns found near "${locationQuery}"</h4>
                            <p class="text-muted mb-4">
                                We couldn't find any medical campaigns in your selected area. 
                                Try searching in a nearby city or check back later for new campaigns.
                            </p>
                        </div>
                        <div class="d-flex justify-content-center gap-3 flex-wrap">
                            <button class="btn btn-outline-primary" onclick="clearLocationSearch()">
                                <i class="fas fa-times me-2"></i>Clear Location
                            </button>
                            <button class="btn btn-primary" onclick="searchAllCampaigns()">
                                <i class="fas fa-list me-2"></i>Show All Campaigns
                            </button>
                        </div>
                    </div>
                </div>
            `;
        }
        
        // Scroll to results
        campaignsContainer.scrollIntoView({ 
            behavior: 'smooth', 
            block: 'start' 
        });
        
    } catch (error) {
        console.error('🗺️ Step ERROR: Error displaying location-based results:', error);
        displaySearchError('Unable to display search results. Please try again.');
    }
}

function displaySearchResults(data) {
    console.log('🔍 Step 10: Displaying search results');
    console.log('🔍 Data structure:', Object.keys(data));
    
    // Target the specific campaigns grid container
    let campaignsContainer = document.querySelector('#campaignsGrid');
    console.log('🔍 Campaigns container (#campaignsGrid) found:', !!campaignsContainer);
    
    if (!campaignsContainer) {
        console.error('🔍 ERROR: #campaignsGrid container not found, trying fallback');
        // Fallback to other possible containers
        campaignsContainer = document.querySelector('.campaigns-grid .container .row');
        if (campaignsContainer) {
            console.log('🔍 Using fallback container (.campaigns-grid .container .row)');
        } else {
            console.error('🔍 ERROR: No suitable container found');
            return;
        }
    }
    
    try {
        if (data.campaigns && data.campaigns.length > 0) {
            console.log('🔍 Step 11: Building HTML for', data.campaigns.length, 'campaigns');
            
            // Build campaigns HTML
            let campaignsHtml = '';
            
            data.campaigns.forEach((campaign, index) => {
                console.log(`🔍 Processing campaign ${index + 1}:`, campaign.title);
                campaignsHtml += createCampaignCardHtml(campaign);
            });
            
            console.log('🔍 Step 12: Setting campaigns HTML in container');
            campaignsContainer.innerHTML = campaignsHtml;
            console.log('🔍 ✅ Successfully displayed', data.campaigns.length, 'campaigns in correct container');
            
        } else {
            console.log('🔍 Step 11: No campaigns found, showing no results message');
            // No campaigns found
            campaignsContainer.innerHTML = `
                <div class="col-12">
                    <div class="text-center p-4">
                        <i class="fas fa-search text-muted mb-3" style="font-size: 3rem;"></i>
                        <h4>No campaigns found</h4>
                        <p class="text-muted">Try adjusting your search criteria or location.</p>
                    </div>
                </div>
            `;
        }
        
    } catch (error) {
        console.error('🔍 Step ERROR: Error displaying search results:', error);
        displaySearchError('Unable to display search results. Please try again.');
    }
}

function createLocationAwareCampaignCardHtml(campaign) {
    // Format dates
    const startDate = campaign.start_date || 'TBA';
    const endDate = campaign.end_date || 'TBA';
    
    // Calculate progress values
    const totalRegistered = campaign.total_registered || 0;
    const expectedPatients = campaign.expected_patients || 100;
    const registrationProgress = expectedPatients > 0 ? Math.round((totalRegistered / expectedPatients) * 100) : 0;
    
    const totalSponsored = campaign.total_sponsored || 0;
    const targetAmount = campaign.target_amount || 10000;
    const sponsorshipProgress = targetAmount > 0 ? Math.round((totalSponsored / targetAmount) * 100) : 0;
    
    // Distance badge with proper styling
    const distanceBadge = campaign.distance_text ? 
        `<span class="location-badge full-width-badge ${campaign.distance_class || 'distance-very-near'}">
            <i class="fas fa-map-marker-alt"></i>
            <span class="distance-text">${campaign.distance_text}</span>
        </span>` : '';
    
    // Registration cost badge
    const registrationFee = campaign.registration_payment || 0;
    const costBadge = registrationFee > 0 ? 
        `<span class="cost-badge full-width-cost-badge cost-paid">
            <i class="fas fa-rupee-sign me-1"></i>₹${new Intl.NumberFormat().format(registrationFee)}
        </span>` :
        `<span class="cost-badge full-width-cost-badge cost-free">
            <i class="fas fa-gift me-1"></i>FREE
        </span>`;
    
    // Image/thumbnail section
    const imageSection = campaign.thumbnail ? 
        `<img src="${campaign.thumbnail}" alt="${campaign.title}" class="campaign-image-responsive">` :
        `<div class="d-flex align-items-center justify-content-center h-100 campaign-placeholder">
            <div class="text-center">
                <i class="fas fa-calendar-medical" style="font-size: 3rem; margin-bottom: 1rem; color: #667eea;"></i>
                <h5 style="color: #2C2A4C; margin: 0; font-weight: 600;">${campaign.title}</h5>
                <p style="color: #6c757d; margin: 0.5rem 0 0 0; font-size: 0.9rem;">Medical Camp</p>
            </div>
        </div>`;

    return `
        <div class="col-md-6 col-lg-4 mb-3 campaign-item fade-in" data-campaign-id="${campaign.id}">
            <div class="campaign-card compact-layout">
                <!-- Campaign Image/Video (Full Width) -->
                <div class="campaign-image-full" onclick="window.location.href='${campaign.view_url}'" style="cursor: pointer;">
                    ${imageSection}
                    ${distanceBadge}
                    ${costBadge}
                </div>

                <!-- Campaign Content (Full Width Below Image) -->
                <div class="campaign-content-full">
                    <!-- Title -->
                    <h4 class="campaign-title-full" onclick="window.location.href='${campaign.view_url}'" style="cursor: pointer;">${campaign.title}</h4>
                    
                    <!-- Doctor and Specialty Info -->
                    <div class="campaign-detail-grid">
                        <div class="detail-row">
                            <div class="detail-item-full compact-detail">
                                <i class="fas fa-user-md text-primary"></i>
                                <span>${campaign.doctor_name || 'TBA'}</span>
                            </div>
                            ${campaign.specialty ? `
                            <div class="detail-item-full compact-detail">
                                <i class="fas fa-stethoscope text-success"></i>
                                <span>${campaign.specialty}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-item-full compact-detail">
                                <i class="fas fa-calendar text-warning"></i>
                                <span>${startDate} - ${endDate}</span>
                            </div>
                        </div>

                        ${campaign.location ? `
                        <div class="detail-row">
                            <div class="detail-item-full location-full">
                                <i class="fas fa-map-marker-alt text-danger"></i>
                                <span>${campaign.location}</span>
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Description -->
                    ${campaign.description ? `
                    <div class="campaign-description-full">
                        ${campaign.description.length > 120 ? campaign.description.substring(0, 120) + '...' : campaign.description}
                    </div>
                    ` : ''}

                    <!-- Action Buttons Row -->
                    <div class="campaign-actions-row">
                        <a href="/user/campaigns/${campaign.id}/register" class="btn-action btn-register-full">
                            <i class="fas fa-user-plus"></i>
                            <span>Register</span>
                        </a>
                        
                        <a href="/user/campaigns/${campaign.id}/sponsor" class="btn-action btn-sponsor-full">
                            <i class="fas fa-hand-holding-heart"></i>
                            <span>Sponsor</span>
                        </a>

                       <button
  onclick="shareEnhancedCampaign(
    {{ json_encode($campaign->id) }},
    {{ json_encode($campaignUrl) }},
    {{ json_encode($campaign->title) }},
    {{ json_encode($campaign->description) }},
    {{ json_encode($campaign->thumbnail ? asset('storage/' . $campaign->thumbnail) : '') }}
  )"
  class="btn-action btn-share-full"
>
  <i class="fas fa-share-alt"></i>
  <span>Share</span>
</button>

                    </div>

                    <!-- Progress Bars Section -->
                    <div class="progress-section-full">
                        <!-- Registration Progress -->
                        <div class="progress-item-full">
                            <div class="progress-header">
                                <span class="progress-label">Registration Progress</span>
                                <span class="progress-value">${totalRegistered}/${expectedPatients}</span>
                            </div>
                            <div class="progress-bar-full">
                                <div class="progress-fill registration-progress" style="width: ${registrationProgress}%"></div>
                            </div>
                            <div class="progress-percentage">${registrationProgress}% Complete</div>
                        </div>
                        
                        <!-- Sponsorship Progress -->
                        <div class="progress-item-full">
                            <div class="progress-header">
                                <span class="progress-label">Funding Progress</span>
                                <span class="progress-value">₹${new Intl.NumberFormat().format(totalSponsored)}</span>
                            </div>
                            <div class="progress-bar-full">
                                <div class="progress-fill sponsorship-progress" style="width: ${sponsorshipProgress}%"></div>
                            </div>
                            <div class="progress-percentage">${sponsorshipProgress}% Funded</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

// Helper functions for location search
function clearLocationSearch() {
    const locationInput = document.getElementById('locationSearchInput');
    if (locationInput) {
        locationInput.value = '';
        
        // Hide location indicator
        const locationIndicator = document.getElementById('locationActiveIndicator');
        if (locationIndicator) {
            locationIndicator.style.display = 'none';
        }
        
        // Clear global coordinates
        userLatitude = null;
        userLongitude = null;
        
        // Trigger search to show all campaigns
        const searchQuery = document.getElementById('campaignSearchMain')?.value.trim() || '';
        performLocationBasedSearch(searchQuery, '');
    }
}

function searchAllCampaigns() {
    // Clear both search and location
    const searchInput = document.getElementById('campaignSearchMain');
    const locationInput = document.getElementById('locationSearchInput');
    
    if (searchInput) searchInput.value = '';
    if (locationInput) locationInput.value = '';
    
    // Hide location indicator
    const locationIndicator = document.getElementById('locationActiveIndicator');
    if (locationIndicator) {
        locationIndicator.style.display = 'none';
    }
    
    // Clear global coordinates
    userLatitude = null;
    userLongitude = null;
    
    // Load all campaigns
    performLocationBasedSearch('', '');
}
    
function createCampaignCardHtml(campaign) {
    const imageUrl = campaign.thumbnail || '/images/default-campaign.jpg';
    
    // Format dates
    const startDate = campaign.start_date || 'TBA';
    const endDate = campaign.end_date || 'TBA';
    
    // Calculate progress values
    const totalRegistered = campaign.total_registered || 0;
    const expectedPatients = campaign.expected_patients || 100;
    const registrationProgress = expectedPatients > 0 ? Math.round((totalRegistered / expectedPatients) * 100) : 0;
    
    const totalSponsored = campaign.total_sponsored || 0;
    const targetAmount = campaign.target_amount || 10000;
    const sponsorshipProgress = targetAmount > 0 ? Math.round((totalSponsored / targetAmount) * 100) : 0;
    
    // Distance badge with proper styling
    const distanceBadge = campaign.distance_text ? 
        `<span class="location-badge full-width-badge ${campaign.distance_class || 'distance-very-near'}">
            <i class="fas fa-map-marker-alt"></i>
            <span class="distance-text">${campaign.distance_text}</span>
        </span>` : '';
    
    // Registration cost badge
    const registrationFee = campaign.registration_payment || 0;
    const costBadge = registrationFee > 0 ? 
        `<span class="cost-badge full-width-cost-badge cost-paid">
            <i class="fas fa-rupee-sign me-1"></i>₹${new Intl.NumberFormat().format(registrationFee)}
        </span>` :
        `<span class="cost-badge full-width-cost-badge cost-free">
            <i class="fas fa-gift me-1"></i>FREE
        </span>`;
    
    return `
        <div class="col-md-6 col-lg-4 mb-3 campaign-item fade-in" data-campaign-id="${campaign.id}">
            <div class="campaign-card compact-layout">
                <!-- Campaign Image/Video (Full Width) -->
                <div class="campaign-image-full" onclick="window.location.href='/user/campaigns/${campaign.id}/view'" style="cursor: pointer;">
                    <img src="${imageUrl}" alt="${campaign.title}" class="campaign-image-responsive" onerror="this.src='/images/default-campaign.jpg'">
                    
                    ${distanceBadge}
                    ${costBadge}
                </div>

                <!-- Campaign Content (Full Width Below Image) -->
                <div class="campaign-content-full">
                    <!-- Title -->
                    <h4 class="campaign-title-full" onclick="window.location.href='/user/campaigns/${campaign.id}/view'" style="cursor: pointer;">${campaign.title}</h4>
                    
                    <!-- Doctor and Specialty Info -->
                    <div class="campaign-detail-grid">
                        <div class="detail-row">
                            <div class="detail-item-full compact-detail">
                                <i class="fas fa-user-md text-primary"></i>
                                <span>${campaign.doctor_name || 'TBA'}</span>
                            </div>
                            ${campaign.specialty ? `
                            <div class="detail-item-full compact-detail">
                                <i class="fas fa-stethoscope text-success"></i>
                                <span>${campaign.specialty}</span>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="detail-row">
                            <div class="detail-item-full compact-detail">
                                <i class="fas fa-calendar text-warning"></i>
                                <span>${startDate} - ${endDate}</span>
                            </div>
                        </div>

                        ${campaign.location ? `
                        <div class="detail-row">
                            <div class="detail-item-full location-full">
                                <i class="fas fa-map-marker-alt text-danger"></i>
                                <span>${campaign.location}</span>
                            </div>
                        </div>
                        ` : ''}
                    </div>

                    <!-- Description -->
                    ${campaign.description ? `
                    <div class="campaign-description-full">
                        ${campaign.description.length > 120 ? campaign.description.substring(0, 120) + '...' : campaign.description}
                    </div>
                    ` : ''}

                    <!-- Action Buttons Row -->
                    <div class="campaign-actions-row">
                        <a href="/user/campaigns/${campaign.id}/register" class="btn-action btn-register-full">
                            <i class="fas fa-user-plus"></i>
                            <span>Register</span>
                        </a>
                        
                        <a href="/user/campaigns/${campaign.id}/sponsor" class="btn-action btn-sponsor-full">
                            <i class="fas fa-hand-holding-heart"></i>
                            <span>Sponsor</span>
                        </a>

                      <button
  onclick="shareEnhancedCampaign(
    {{ json_encode($campaign->id) }},
    {{ json_encode($campaignUrl) }},
    {{ json_encode($campaign->title) }},
    {{ json_encode($campaign->description) }},
    {{ json_encode($campaign->thumbnail ? asset('storage/' . $campaign->thumbnail) : '') }}
  )"
  class="btn-action btn-share-full"
>
  <i class="fas fa-share-alt"></i>
  <span>Share</span>
</button>

                    </div>

                    <!-- Progress Bars Section -->
                    <div class="progress-section-full">
                        <!-- Registration Progress -->
                        <div class="progress-item-full">
                            <div class="progress-header">
                                <span class="progress-label">Registration Progress</span>
                                <span class="progress-value">${totalRegistered}/${expectedPatients}</span>
                            </div>
                            <div class="progress-bar-full">
                                <div class="progress-fill registration-progress" style="width: ${registrationProgress}%"></div>
                            </div>
                            <div class="progress-percentage">${registrationProgress}% Complete</div>
                        </div>
                        
                        <!-- Sponsorship Progress -->
                        <div class="progress-item-full">
                            <div class="progress-header">
                                <span class="progress-label">Funding Progress</span>
                                <span class="progress-value">₹${new Intl.NumberFormat().format(totalSponsored)}</span>
                            </div>
                            <div class="progress-bar-full">
                                <div class="progress-fill sponsorship-progress" style="width: ${sponsorshipProgress}%"></div>
                            </div>
                            <div class="progress-percentage">${sponsorshipProgress}% Funded</div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
}

function displaySearchError(message) {
    console.error('🔍 Search Error:', message);
    
    // Target the specific campaigns grid container
    const campaignsContainer = document.querySelector('#campaignsGrid');
    if (campaignsContainer) {
        campaignsContainer.innerHTML = `
            <div class="col-12">
                <div class="text-center p-4">
                    <i class="fas fa-exclamation-triangle text-warning mb-3" style="font-size: 2rem;"></i>
                    <p class="text-muted">${message}</p>
                    <small class="text-muted">Check console for more details</small>
                </div>
            </div>
        `;
        console.log('🔍 Error message displayed in #campaignsGrid');
    } else {
        console.error('🔍 ERROR: Could not find #campaignsGrid to display error');
    }
    
    // Hide loading state
    showSearchLoading(false);
}

function showSearchLoading(show) {
    const loadingElement = document.getElementById('searchLoading');
    if (loadingElement) {
        loadingElement.style.display = show ? 'block' : 'none';
    }
    
    // Also show loading in campaigns container if no campaigns yet
    if (show) {
        const campaignsContainer = document.querySelector('#campaignsGrid, .campaigns-grid, .row');
        if (campaignsContainer && !campaignsContainer.innerHTML.trim()) {
            campaignsContainer.innerHTML = `
                <div class="col-12">
                    <div class="text-center">
                        <i class="fas fa-spinner fa-spin fa-2x"></i>
                        <p class="mt-2">Loading campaigns...</p>
                    </div>
                </div>
            `;
        }
    }
}

// ===== SEARCH EVENT HANDLERS =====
function setupSearchEventListeners() {
    debugLog('Setting up search event listeners');
    
    // Main search input
    const searchInput = document.getElementById('campaignSearchMain');
    if (searchInput) {
        console.log('🔍 Search input found, setting up event listeners');
        
        searchInput.addEventListener('input', function() {
            clearTimeout(searchTimeout);
            const query = this.value.trim();
            console.log('🔍 Search input changed:', query);
            
            searchTimeout = setTimeout(() => {
                console.log('🔍 Search debounce completed, performing search for:', query);
                const locationQuery = getCurrentLocationText();
                console.log('🔍 Current location text:', locationQuery);
                performLocationBasedSearch(query, locationQuery);
            }, 300); // 300ms debounce
        });
        
        searchInput.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                console.log('🔍 Escape key pressed, clearing search');
                this.value = '';
                performLocationBasedSearch('', getCurrentLocationText());
            }
        });
        
        console.log('🔍 Search input event listeners set up successfully');
    } else {
        console.error('🔍 ERROR: Search input not found!');
    }
    
    // Inline location input
    const locationInput = document.getElementById('locationSearchInput');
    if (locationInput) {
        locationInput.addEventListener('input', function() {
            const locationQuery = this.value.trim();
            console.log('📍 Location input changed:', locationQuery);
            
            // Clear any existing error messages when user starts typing
            const existingError = this.parentElement.querySelector('.location-error');
            if (existingError) {
                existingError.remove();
                this.classList.remove('is-invalid');
            }
            
            // Automatically trigger search when location changes (with debounce)
            clearTimeout(this.searchTimeout);
            this.searchTimeout = setTimeout(() => {
                const searchQuery = document.getElementById('campaignSearchMain')?.value.trim() || '';
                performLocationBasedSearch(searchQuery, locationQuery);
            }, 500); // 500ms debounce
        });
        
        console.log('📍 Inline location input event listeners set up successfully');
    } else {
        console.error('📍 ERROR: Location input not found!');
    }
}

function getCurrentLocationText() {
    const locationInput = document.getElementById('locationSearchInput');
    const inputLocation = locationInput ? locationInput.value.trim() : '';
    
    // Priority 1: User-entered location in search input
    if (inputLocation && inputLocation.length > 0) {
        return inputLocation;
    }
    
    // Priority 2: Current coordinates (if available)
    if (userLatitude && userLongitude) {
        return `${userLatitude.toFixed(4)}, ${userLongitude.toFixed(4)}`;
    }
    
    // Priority 3: Default to Pune coordinates
    return 'Pune, Maharashtra, IN';
}
// ===== LOCATION UPDATE FUNCTIONS =====
function updateUserLocationInDatabase(latitude, longitude, address) {
    // Only update if user is logged in
    if (!isUserLoggedIn) {
        console.log('🗺️ User not logged in, skipping database location update');
        return;
    }
    
    console.log('🗺️ Updating user location in database:', {
        latitude: latitude,
        longitude: longitude,
        address: address
    });
    
    // This will be handled by the search API call with update_user_location flag
    // No need for separate API call
}

function performLocationBasedSearchWithCoordinates(searchQuery, locationQuery, latitude, longitude) {
    console.log('🔍 =========================');
    console.log('🔍 LOCATION-BASED SEARCH WITH COORDINATES');
    console.log('🔍 =========================');
    console.log('🔍 Search term:', searchQuery);
    console.log('🔍 Location:', locationQuery);
    console.log('🔍 Coordinates:', latitude, longitude);
    
    try {
        // Show loading state
        showSearchLoading(true);
        
        // Clear previous search timeout
        if (searchTimeout) {
            clearTimeout(searchTimeout);
        }
        
        console.log('🔍 Step 1: Preparing search data with coordinates');
        
        // Prepare search data with coordinates
        const searchData = {
            search: searchQuery || '',
            location: locationQuery || '',
            latitude: latitude,
            longitude: longitude,
            update_user_location: isUserLoggedIn, // Update user's stored location
            validate_location: false, // Skip validation since coordinates are from Google Places
            _token: getCSRFToken()
        };
        
        console.log('🔍 Step 2: Search data prepared:', searchData);
        console.log('🔍 Step 3: Making AJAX request to /user/search-campaigns');
        
        // Make AJAX request
        fetch('/user/search-campaigns', {
            method: 'POST',
            headers: {
                'Content-Type': 'application/json',
                'X-CSRF-TOKEN': getCSRFToken(),
                'Accept': 'application/json'
            },
            body: JSON.stringify(searchData)
        })
        .then(response => {
            console.log('🔍 Step 4: Response received, status:', response.status);
            return response.json(); // Parse JSON regardless of status
        })
        .then(data => {
            console.log('🔍 Step 5: JSON data parsed:', data);
            
            // Check if there's an error response
            if (!data.success) {
                console.log('🔍 Step ERROR: Search failed with message:', data.message);
                handleSearchError(new Error(data.message), searchQuery);
                return;
            }
            
            handleLocationBasedSearchSuccess(data, searchQuery, locationQuery);
        })
        .catch(error => {
            console.error('🔍 Step ERROR: Search request failed:', error);
            handleSearchError(error, searchQuery);
        });
        
    } catch (error) {
        console.error('🔍 Step ERROR: Exception in performLocationBasedSearchWithCoordinates:', error);
        handleSearchError(error, searchQuery);
    }
}

function handleLocationBasedSearchSuccess(data, searchQuery, locationQuery) {
    console.log('🔍 Step 6: Handling location-based search success');
    console.log('🔍 Response data:', data);
    console.log('🔍 Campaigns count:', data.campaigns ? data.campaigns.length : 0);
    
    try {
        // Hide loading state
        console.log('🔍 Step 7: Hiding loading state');
        showSearchLoading(false);
        
        // Store last search query
        lastSearchQuery = searchQuery;
        
        // Display results with location context
        console.log('🔍 Step 8: Displaying location-based search results');
        displayLocationBasedResults(data, locationQuery);
        
        // Show success message
        if (data.campaigns && data.campaigns.length > 0) {
            console.log(`✅ Found ${data.campaigns.length} campaigns near ${locationQuery}`);
            
            // Show location update success
            if (data.location_info && data.location_info.location_updated) {
                console.log('✅ User location updated successfully');
            }
        } else {
            console.log(`ℹ️ No campaigns found near ${locationQuery}`);
        }
        
    } catch (error) {
        console.error('🔍 Step ERROR: Error in handleLocationBasedSearchSuccess:', error);
        handleSearchError(error, searchQuery);
    }
}

// ===== GOOGLE MAPS INTEGRATION =====
function initializePlacesAutocomplete() {
    debugLog('Attempting to initialize Places Autocomplete');
    
    if (!googleMapsLoaded) {
        debugLog('Google Maps not loaded yet, retrying in 500ms');
        setTimeout(initializePlacesAutocomplete, 500);
        return;
    }
    
    const locationInput = document.getElementById('locationSearchInput');
    if (!locationInput) {
        errorLog('Location input element not found');
        return;
    }
    
    // Check if Google Maps and Places are available
    if (!window.google || !window.google.maps || !window.google.maps.places) {
        debugLog('Google Maps Places API not ready, retrying in 500ms');
        setTimeout(initializePlacesAutocomplete, 500);
        return;
    }
    
    try {
        debugLog('Initializing Places Autocomplete...');
        debugLog('Google Maps available: ' + !!(window.google && window.google.maps));
        debugLog('Places library available: ' + !!(window.google && window.google.maps && window.google.maps.places));
        
        // Use the reliable legacy Autocomplete implementation
        const autocomplete = new google.maps.places.Autocomplete(locationInput, {
            types: ['geocode', 'establishment'],  // Include establishments for better results
            componentRestrictions: { country: 'IN' },
            fields: ['geometry', 'formatted_address', 'name', 'address_components']
        });
        
        debugLog('Places Autocomplete instance created successfully');
        
        // Ensure the input is visible and properly styled
        locationInput.style.display = 'block';
        locationInput.style.zIndex = '1';
        
        // Fix z-index issue for autocomplete dropdown immediately
        const fixDropdownZIndex = () => {
            const pacContainer = document.querySelector('.pac-container');
            if (pacContainer) {
                pacContainer.style.zIndex = '10000 !important';
                pacContainer.style.position = 'absolute !important';
                pacContainer.style.display = 'block !important';
                debugLog('Fixed autocomplete dropdown z-index and display');
                return true;
            }
            return false;
        };
        
        // Try to fix z-index immediately and with delays
        setTimeout(fixDropdownZIndex, 50);
        setTimeout(fixDropdownZIndex, 100);
        setTimeout(fixDropdownZIndex, 200);
        
        // Monitor for pac-container creation and fix z-index
        const observer = new MutationObserver((mutations) => {
            mutations.forEach((mutation) => {
                if (mutation.type === 'childList') {
                    mutation.addedNodes.forEach((node) => {
                        if (node.nodeType === 1 && (node.classList?.contains('pac-container') || node.querySelector?.('.pac-container'))) {
                            setTimeout(fixDropdownZIndex, 10);
                        }
                    });
                    
                    // Also check for any pac-container that might exist
                    fixDropdownZIndex();
                }
            });
        });
        
        observer.observe(document.body, {
            childList: true,
            subtree: true
        });
        
        // Force re-check periodically for the first few seconds
        const intervalId = setInterval(() => {
            fixDropdownZIndex();
        }, 100);
        
        setTimeout(() => {
            clearInterval(intervalId);
        }, 3000);
        
        // Add focus and input listeners to ensure dropdown appears
        locationInput.addEventListener('focus', function() {
            debugLog('Location input focused');
            setTimeout(fixDropdownZIndex, 10);
        });
        
        locationInput.addEventListener('input', function() {
            debugLog('Location input changed: ' + this.value);
            setTimeout(fixDropdownZIndex, 10);
        });
        
        autocomplete.addListener('place_changed', function() {
            const place = autocomplete.getPlace();
            
            debugLog('Place changed event fired');
            debugLog('Place object:', place);
            
            if (place.geometry && place.formatted_address) {
                console.log('🗺️ Valid place selected:', place.name || place.formatted_address);
                console.log('🗺️ Place coordinates:', place.geometry.location.lat(), place.geometry.location.lng());
                
                // Update global coordinates with selected place
                userLatitude = place.geometry.location.lat();
                userLongitude = place.geometry.location.lng();
                
                // Clear any existing location errors
                const existingError = locationInput.parentElement.querySelector('.location-error');
                if (existingError) {
                    existingError.remove();
                    locationInput.classList.remove('is-invalid');
                }
                
                // Update location input with formatted address
                locationInput.value = place.formatted_address;
                
                // Show location active indicator
                const locationIndicator = document.getElementById('locationActiveIndicator');
                if (locationIndicator) {
                    locationIndicator.style.display = 'inline-block';
                    locationIndicator.title = `Location set to: ${place.formatted_address}`;
                }
                
                // Update user's stored location if logged in
                updateUserLocationInDatabase(userLatitude, userLongitude, place.formatted_address);
                
                // Update location display
                updateLocationDisplay(place.formatted_address);
                
                // Show success notification
                console.log('✅ Location updated successfully:', place.formatted_address);
                
                // Perform location-based search for nearby campaigns
                console.log('🔍 Searching for campaigns near selected location...');
                const searchQuery = document.getElementById('campaignSearchMain')?.value.trim() || '';
                
                // Pass coordinates to search for better location-based results
                performLocationBasedSearchWithCoordinates(searchQuery, place.formatted_address, userLatitude, userLongitude);
                
            } else if (place.name && !place.geometry) {
                // User selected a place but it doesn't have geometry
                debugLog('Place selected but no geometry available');
                
                // Try to geocode the place name
                const geocoder = new google.maps.Geocoder();
                geocoder.geocode({ address: place.name }, function(results, status) {
                    if (status === 'OK' && results[0]) {
                        const location = results[0];
                        userLatitude = location.geometry.location.lat();
                        userLongitude = location.geometry.location.lng();
                        locationInput.value = location.formatted_address;
                        
                        console.log('✅ Geocoded location:', location.formatted_address);
                        performLocationBasedSearchWithCoordinates(searchQuery, location.formatted_address, userLatitude, userLongitude);
                    } else {
                        debugLog('Geocoding failed for: ' + place.name);
                        showLocationError('Unable to find coordinates for this location. Please try a different search.');
                    }
                });
                
            } else {
                debugLog('Invalid place selected - no geometry or address');
                
                // Show error for invalid selection
                setTimeout(() => {
                    const currentValue = locationInput.value.trim();
                    if (currentValue && currentValue.length > 2) {
                        showLocationError('Please select a location from the dropdown suggestions.');
                    }
                }, 100);
            }
        });
        
        // Add function to show location errors
        function showLocationError(message) {
            // Remove existing error first
            const existingError = locationInput.parentElement.querySelector('.location-error');
            if (existingError) {
                existingError.remove();
            }
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'location-error';
            errorDiv.style.cssText = `
                color: #dc3545;
                font-size: 0.875rem;
                margin-top: 0.25rem;
                display: flex;
                align-items: center;
                gap: 0.5rem;
            `;
            errorDiv.innerHTML = `
                <i class="fas fa-exclamation-triangle"></i>
                ${message}
            `;
            
            locationInput.parentElement.appendChild(errorDiv);
            locationInput.classList.add('is-invalid');
            
            // Auto-remove after 5 seconds
            setTimeout(() => {
                if (errorDiv && errorDiv.parentElement) {
                    errorDiv.remove();
                    locationInput.classList.remove('is-invalid');
                }
            }, 5000);
        }
        
        successLog('Places Autocomplete initialized successfully');
        
    } catch (error) {
        errorLog('Error initializing Places Autocomplete', error);
        googleMapsLoaded = false;
    }
}

// ===== UTILITY FUNCTIONS =====
// Helper function to properly add referral parameter to URL
function addReferralToUrl(baseUrl, referralId) {
    if (!referralId) return baseUrl;
    
    // Check if URL already has ref parameter
    if (baseUrl.includes('ref=')) return baseUrl;
    
    // Add referral parameter with proper separator
    const separator = baseUrl.includes('?') ? '&' : '?';
    return baseUrl + separator + 'ref=' + referralId;
}

function shareCleanCampaign(campaignUrl) {
    if (navigator.share) {
        navigator.share({
            title: 'Medical Campaign',
            text: 'Check out this medical campaign!',
            url: campaignUrl
        }).catch(console.error);
    } else {
        // Fallback: Copy to clipboard
        navigator.clipboard.writeText(campaignUrl).then(() => {
            alert('Campaign URL copied to clipboard!');
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = campaignUrl;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            alert('Campaign URL copied to clipboard!');
        });
    }
}

// Enhanced sharing function with referral links and campaign details
function shareEnhancedCampaign(campaignId, baseUrl, title, description, thumbnail) {
    @auth('user')
        const referralId = '{{ auth("user")->user()->your_referral_id }}';
        let shareUrl = baseUrl;
        
        // Properly handle URL parameters
        if (referralId) {
            if (shareUrl.includes('?')) {
                // URL already has parameters, append with &
                if (!shareUrl.includes('ref=')) {
                    shareUrl += '&ref=' + referralId;
                }
            } else {
                // No parameters yet, append with ?
                shareUrl += '?ref=' + referralId;
            }
        }
    @else
        const shareUrl = baseUrl;
    @endauth
    
    const shortDescription = description ? (description.length > 100 ? description.substring(0, 100) + '...' : description) : 'Join this amazing medical campaign and make a difference in healthcare!';
    
    const shareMessage = `🏥 ${title}

${shortDescription}

🔗 Register now: ${shareUrl}

#MedicalCamp #Healthcare #FreeDoctor`;

    if (navigator.share) {
        navigator.share({
            title: `🏥 ${title} - Medical Campaign`,
            text: shareMessage,
            url: shareUrl
        }).then(() => {
            showShareSuccess();
        }).catch(console.error);
    } else {
        // Enhanced clipboard sharing with campaign details
        navigator.clipboard.writeText(shareMessage).then(() => {
            showShareSuccess();
        }).catch(() => {
            // Fallback for older browsers
            const textArea = document.createElement('textarea');
            textArea.value = shareMessage;
            document.body.appendChild(textArea);
            textArea.select();
            document.execCommand('copy');
            document.body.removeChild(textArea);
            showShareSuccess();
        });
    }
}

// Login prompt handler
function handleLoginPrompt(action, redirectUrl) {
    Swal.fire({
        title: 'Login Required',
        text: `Please log in to ${action} for this campaign`,
        icon: 'info',
        showCancelButton: true,
        confirmButtonColor: '#2C2A4C',
        cancelButtonColor: '#6c757d',
        confirmButtonText: 'Login Now',
        cancelButtonText: 'Cancel'
    }).then((result) => {
        if (result.isConfirmed) {
            // Store the redirect URL in session storage
            sessionStorage.setItem('redirectAfterLogin', redirectUrl);
            window.location.href = '{{ route("user.login") }}';
        }
    });
}

// Show share success message
function showShareSuccess() {
    Swal.fire({
        title: 'Shared Successfully!',
        text: 'Campaign link with details has been copied to clipboard',
        icon: 'success',
        timer: 2000,
        showConfirmButton: false,
        toast: true,
        position: 'top-end'
    });
}

// ===== INITIALIZATION =====
function initializeSearchSystem() {
    console.log('🔍 =========================');
    console.log('🔍 INITIALIZING SEARCH SYSTEM');
    console.log('🔍 =========================');
    
    // Set up event listeners
    console.log('🔍 Step 1: Setting up event listeners');
    setupSearchEventListeners();
    
    // Request location permission on page load
    console.log('🔍 Step 2: Requesting location permission');
    requestLocationPermission();
    
    console.log('🔍 ✅ Search system initialization completed');
}

// ===== DOCUMENT READY =====
document.addEventListener('DOMContentLoaded', function() {
    debugLog('DOM loaded, initializing search system');
    
    // Debug: Check if location input exists
    const locationInput = document.getElementById('locationSearchInput');
    if (locationInput) {
        debugLog('✅ Location input found: ' + locationInput.id);
        debugLog('Input placeholder: ' + locationInput.placeholder);
        debugLog('Input value: "' + locationInput.value + '"');
        debugLog('Input visible: ' + (locationInput.offsetWidth > 0 && locationInput.offsetHeight > 0));
    } else {
        debugLog('❌ Location input NOT found - this is the problem!');
    }
    
    initializeSearchSystem();
    
    // Load Google Maps API
    loadGoogleMaps();
});

// Initialize on page load as backup
window.addEventListener('load', function() {
    debugLog('Page loaded, ensuring search system is initialized');
    
    // Initialize if not already done
    if (!userLatitude && !userLongitude) {
        requestLocationPermission();
    }
    
    // Retry Google Maps loading if not loaded
    if (!googleMapsLoaded) {
        loadGoogleMaps();
    }
});

successLog('Location-aware campaign search system loaded successfully');

// ===== PERFORMANCE OPTIMIZATIONS =====

// Cache for search results
const searchCache = new Map();
const CACHE_DURATION = 5 * 60 * 1000; // 5 minutes

// Enhanced fetch with caching
function cachedFetch(url, options, cacheKey) {
    // Check cache first
    if (searchCache.has(cacheKey)) {
        const cached = searchCache.get(cacheKey);
        if (Date.now() - cached.timestamp < CACHE_DURATION) {
            console.log('📦 Using cached data for:', cacheKey);
            return Promise.resolve(cached.data);
        } else {
            searchCache.delete(cacheKey);
        }
    }
    
    // Make fresh request
    return fetch(url, options)
        .then(response => response.json())
        .then(data => {
            // Cache the result
            searchCache.set(cacheKey, {
                data: data,
                timestamp: Date.now()
            });
            return data;
        });
}

// Lazy Loading Implementation
const imageObserver = new IntersectionObserver((entries, observer) => {
    entries.forEach(entry => {
        if (entry.isIntersecting) {
            const img = entry.target;
            img.src = img.dataset.src;
            img.classList.add('loaded');
            observer.unobserve(img);
        }
    });
}, {
    rootMargin: '50px 0px',
    threshold: 0.1
});

// Initialize lazy loading
function initLazyLoading() {
    const lazyImages = document.querySelectorAll('.lazy-load:not(.loaded)');
    lazyImages.forEach(img => imageObserver.observe(img));
}

// Debounce function for better performance
function debounce(func, wait) {
    let timeout;
    return function executedFunction(...args) {
        const later = () => {
            clearTimeout(timeout);
            func(...args);
        };
        clearTimeout(timeout);
        timeout = setTimeout(later, wait);
    };
}

// Throttle function for scroll events
function throttle(func, limit) {
    let inThrottle;
    return function() {
        const args = arguments;
        const context = this;
        if (!inThrottle) {
            func.apply(context, args);
            inThrottle = true;
            setTimeout(() => inThrottle = false, limit);
        }
    }
}

// Optimize search with debouncing
const debouncedSearch = debounce(function(searchTerm, location) {
    performLocationBasedSearch(searchTerm, location);
}, 300);

// Replace immediate search calls with debounced version
const originalPerformSearch = performLocationBasedSearch;
performLocationBasedSearch = function(searchTerm, location) {
    if (arguments.length === 0) {
        return originalPerformSearch('', '');
    }
    return debouncedSearch(searchTerm, location);
};

// Initialize performance optimizations
document.addEventListener('DOMContentLoaded', function() {
    initLazyLoading();
    
    // Re-initialize lazy loading after dynamic content loads
    const campaignGrid = document.getElementById('campaignsGrid');
    if (campaignGrid) {
        const gridObserver = new MutationObserver(() => {
            initLazyLoading();
        });
        gridObserver.observe(campaignGrid, { childList: true });
    }
});

// Preload critical resources
function preloadCriticalResources() {
    const link = document.createElement('link');
    link.rel = 'preload';
    link.as = 'image';
    link.href = 'data:image/svg+xml,%3Csvg xmlns="http://www.w3.org/2000/svg" width="300" height="200"%3E%3Crect width="100%" height="100%" fill="%23f0f0f0"/%3E%3C/svg%3E';
    document.head.appendChild(link);
}

preloadCriticalResources();


</script>
@endpush